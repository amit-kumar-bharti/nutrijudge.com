<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="Supplement comparison tool - Compare multiple products side by side" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --primary-color: #000;
            --secondary-color: #222;
            --accent-color: #444;
            --light-color: #fff;
            --dark-color: #000;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-color);
            color: var(--primary-color);
        }
        
        .dark-theme {
            background: #333 !important;
            color: #fff !important;
        }
        .light-theme {
            background: #fff !important;
            color: #000 !important;
        }
        
        /* --- START: Home page navbar CSS --- */
        .navbar {
            background: var(--light-color) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05) !important;
            border: none !important;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }
        .navbar-brand {
            font-weight: bold;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 0;
            margin: 0;
            padding: 0;
            color: var(--primary-color) !important;
            text-shadow: none;
            transition: color 0.3s;
        }
        .navbar-brand:hover {
            color: var(--secondary-color) !important;
        }
        .navbar-logo {
            height: 80px;
            width: auto;
            border-radius: 12px;
            margin: 0;
            padding: 0;
            background: var(--light-color) !important;
            filter: none;
            opacity: 1;
        }
        .nav-link, .navbar-nav .dropdown-toggle {
            color: var(--primary-color) !important;
            font-weight: 500;
            transition: all 0.3s ease;
            text-shadow: none;
            background: var(--light-color) !important;
        }
        .nav-link:hover, .navbar-nav .dropdown-toggle:hover, .nav-link.active, .navbar-nav .dropdown-toggle.active {
            color: var(--light-color) !important;
            background: var(--primary-color) !important;
        }
        /* --- END: Home page navbar CSS --- */
        
        /* Categories Menu Styles */
        .categories-menu {
            min-width: 250px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .category-item {
            padding: 10px 15px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .category-item:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-left-color: var(--accent-color);
            transform: translateX(5px);
        }
        
        .category-item i {
            width: 20px;
            text-align: center;
        }
        
        .category-item.protein:hover {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        .category-item.gainers:hover {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }
        .category-item.pre-workout:hover {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        .category-item.post-workout:hover {
            background: linear-gradient(135deg, #6f42c1, #e83e8c);
        }
        .category-item.ayurveda:hover {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        .category-item.supplement:hover {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }
        .category-item.fat-burner:hover {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        .navbar-nav .dropdown:hover .dropdown-menu {
            display: block !important;
        }
        .navbar-nav .dropdown .dropdown-menu {
            margin-top: 0;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border: none;
            animation: fadeInDown 0.3s ease;
        }
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .dropdown-menu:hover {
            display: block !important;
        }
        
        /* Hover Dropdown Styles */
        .navbar-nav .dropdown .dropdown-menu {
            margin-top: 0;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border: none;
            animation: fadeInDown 0.3s ease;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Ensure dropdown stays open when hovering over menu items */
        .dropdown-menu:hover {
            display: block !important;
        }
        
        .dropdown-menu,
        .dropdown-menu-end {
            background: var(--primary-color) !important;
            color: #fff;
        }
        .dropdown-menu .dropdown-item {
            color: #fff;
        }
        .dropdown-menu .dropdown-item:hover, .dropdown-menu .dropdown-item:focus {
            background: rgba(0,0,0,0.08);
            color: #fff;
        }

        .navbar-nav .dropdown-toggle:hover,
        #hamburgerMenu:hover {
            background: #88304E !important;
            color: #fff !important;
            border-color: #88304E !important;
        }
        .navbar-nav .dropdown-toggle:focus,
        #hamburgerMenu:focus {
            background: #88304E !important;
            color: #fff !important;
            border-color: #88304E !important;
        }
        
        @media (max-width: 768px) {
            .navbar-logo {
                width: 60px;
                height: 60px;
                background: transparent !important;
                filter: brightness(1.1) contrast(1.1);
            }
            .navbar-brand {
                font-size: 1.5rem;
            }
        }
        
        td>img {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border-radius: 10px;
            transition: transform 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            filter: none !important;
        }
        
        td>img:hover {
            transform: scale(1.05);
        }
        
        .comparison-hero-image {
            max-height: 350px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .comparison-hero-image:hover {
            transform: scale(1.02);
        }
        
        .product-thumbnail {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            transition: transform 0.3s ease;
        }
        
        .product-thumbnail:hover {
            transform: scale(1.1);
        }
        
        /* Search Results Styling */
        .search-results-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .search-results-list {
            padding: 0;
            margin: 0;
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .search-result-item:hover {
            background-color: #f8f9fa;
        }
        
        .search-result-item.selected {
            background-color: #e3f2fd;
        }
        
        .search-result-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
            margin-right: 12px;
        }
        
        .search-result-content {
            flex: 1;
        }
        
        .search-result-title {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            margin-bottom: 2px;
        }
        
        .search-result-brand {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .search-result-price {
            font-weight: 600;
            font-size: 13px;
            color: var(--primary-color);
            margin-bottom: 2px;
        }
        
        .search-result-rating {
            font-size: 11px;
            color: #ffc107;
        }
        
        .no-results {
            padding: 20px;
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .remove-product-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #dc3545;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
        }
        
        .remove-product-btn:hover {
            background: #c82333;
        }
        
        /* Price Display Styling */
        .price-display {
            text-align: center;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .original-price {
            font-size: 14px;
            text-decoration: line-through;
            color: #6c757d;
        }
        
        .discount-badge {
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 2px;
        }
        
        .savings-amount {
            color: #28a745;
            font-size: 12px;
            font-weight: 600;
            margin-top: 2px;
        }
        
        .price-per-serving {
            color: #6c757d;
            font-size: 11px;
            margin-top: 2px;
        }
        
        /* Price Comparison Highlights */
        .price-highlight-best {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }
        
        .price-highlight-expensive {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }
        
        /* Rating Comparison Highlights */
        .rating-highlight-best {
            background-color: #fff3cd !important;
            border-color: #ffeaa7 !important;
        }
        
        .rating-highlight-low {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }
        
        /* Step Indicator Styles */
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        .step.active {
            opacity: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .step.active .step-number {
            background: var(--primary-color);
            box-shadow: 0 4px 12px rgba(255, 11, 85, 0.3);
        }
        
        .step-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--dark-color);
            text-align: center;
        }
        
        .step.active .step-label {
            color: var(--primary-color);
        }
        
        /* Progress Bar Styles */
        .progress {
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transition: width 0.5s ease;
        }
        
        /* Comparison Controls Styles */
        .comparison-controls {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
        }
        
        /* Table Styles */
        .table {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1rem;
            font-weight: 600;
        }
        
        .table td {
            padding: 1rem;
            vertical-align: middle;
            border: 1px solid #e9ecef;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        /* Product Column Styles */
        .product-column {
            position: relative;
            min-width: 300px;
            background: var(--light-color);
            color: var(--primary-color);
        }
        
        .product-column .input-group {
            position: relative;
        }
        
        .product-column .form-control {
            border-radius: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .product-column .input-group:has(.btn) .form-control {
            border-radius: 25px 0 0 25px;
        }
        
        .product-column .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 11, 85, 0.15);
        }
        
        .product-column .btn {
            border-radius: 0 25px 25px 0;
            border: 2px solid var(--primary-color);
            border-left: none;
            background: transparent;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .product-column .btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .comparison-header-image {
            max-width: 200px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        .table th {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .table td {
            border: 1px solid #dee2e6;
            vertical-align: middle;
        }
        .form-control:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        /* Step Indicator Styles */
        .step-indicator {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        .step.active {
            opacity: 1;
        }
        
        .step.completed {
            opacity: 0.8;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .step.active .step-number {
            background: var(--primary-color);
            color: white;
        }
        
        .step.completed .step-number {
            background: var(--secondary-color);
            color: white;
        }
        
        .step-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #6c757d;
            text-align: center;
        }
        
        .step.active .step-label {
            color: var(--primary-color);
        }
        
        .step.completed .step-label {
            color: var(--secondary-color);
        }
        
        /* Navigation button styles */
        .btn, .btn-primary, .btn-outline-primary, .btn-outline-secondary, .remove-product-btn, .add-product-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none !important;
            color: #fff !important;
            font-weight: 600;
            border-radius: 25px;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .btn:hover, .btn-primary:hover, .btn-outline-primary:hover, .btn-outline-secondary:hover, .remove-product-btn:hover, .add-product-btn:hover {
            background: var(--primary-color) !important;
            color: #fff !important;
            box-shadow: 0 4px 16px rgba(255,11,85,0.15);
        }
        .btn-outline-primary, .btn-outline-secondary {
            background: transparent !important;
            color: var(--primary-color) !important;
            border: 2px solid var(--primary-color) !important;
        }
        .btn-outline-primary:hover, .btn-outline-secondary:hover {
            background: var(--primary-color) !important;
            color: #fff !important;
        }
        h1, h2, h3, h4, h5, h6, .display-5, .display-6 {
            color: var(--primary-color) !important;
            font-weight: 700;
        }
        .text-primary {
            color: var(--primary-color) !important;
        }
        .text-secondary {
            color: var(--secondary-color) !important;
        }
        .text-muted {
            color: var(--dark-color) !important;
            opacity: 0.7;
        }
        .product-column {
            min-width: 250px;
            max-width: 300px;
        }
        .comparison-controls {
            background: var(--light-color);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .add-product-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        .remove-product-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 50%;
            font-size: 0.8rem;
            position: absolute;
            top: -5px;
            right: -5px;
        }
        .price-highlight {
            background-color: var(--accent-color);
            font-weight: bold;
        }
        .price-warning {
            background-color: var(--light-color);
        }
        
        .rating-highlight {
            background-color: var(--accent-color);
            font-weight: bold;
        }
        
        .rating-warning {
            background-color: var(--light-color);
        }
        

        
        /* Search Results Styles */
        .search-results-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .search-results-list {
            padding: 0;
            margin: 0;
        }
        
        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .search-result-item:hover {
            background-color: #f8f9fa;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-item.selected {
            background-color: var(--primary-color);
            color: white;
        }
        
        .search-result-image {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 6px;
            flex-shrink: 0;
        }
        
        .search-result-content {
            flex: 1;
            min-width: 0;
        }
        
        .search-result-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .search-result-brand {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 2px;
        }
        
        .search-result-price {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .search-result-rating {
            font-size: 0.7rem;
            color: #ffc107;
        }
        
        .no-results {
            padding: 15px;
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }
        
        .search-loading {
            padding: 15px;
            text-align: center;
            color: #6c757d;
        }
        
        .search-loading i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        

        
        .comparison-summary {
            background: linear-gradient(135deg, var(--light-color), var(--accent-color));
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .product-detail-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
        }
        

        
        /* Cart and Wishlist Summary Styles */
        .summary-cards {
            background: linear-gradient(135deg, var(--light-color), var(--accent-color));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary-color);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .summary-card.cart {
            border-left-color: var(--primary-color);
        }
        
        .summary-card.wishlist {
            border-left-color: var(--secondary-color);
        }
        
        .summary-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .summary-card.cart i {
            color: var(--primary-color);
        }
        
        .summary-card.wishlist i {
            color: var(--secondary-color);
        }
        
        .summary-count {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .summary-card.cart .summary-count {
            color: var(--primary-color);
        }
        
        .summary-card.wishlist .summary-count {
            color: var(--secondary-color);
        }
        
        .summary-label {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 15px;
        }
        
        .summary-details {
            font-size: 0.9rem;
            color: var(--dark-color);
            margin-bottom: 15px;
        }
        

        
        .count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Enhanced Price Styling */
        .price-display {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
        }
        
        .current-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .original-price {
            font-size: 1rem;
            color: #6c757d;
            text-decoration: line-through;
            margin-bottom: 5px;
        }
        
        .discount-badge {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        .savings-amount {
            font-size: 0.9rem;
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .price-per-serving {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .price-highlight-best {
            background: linear-gradient(135deg, var(--accent-color), var(--light-color));
            border: 2px solid var(--primary-color);
        }
        
        .price-highlight-expensive {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 2px solid var(--primary-color);
        }

        .dark-theme .navbar,
        .dark-theme .dropdown-menu {
            background: #222 !important;
            color: #fff !important;
        }
        .dark-theme .nav-link, .dark-theme .navbar-nav .dropdown-toggle {
            color: #fff !important;
        }
        .dark-theme .nav-link:hover, .dark-theme .navbar-nav .dropdown-toggle:hover {
            background: #fff !important;
            color: #000 !important;
        }

        /* Categories Dropdown Button - White by default, black on hover, no border */
        .nav-link.dropdown-toggle#categoriesDropdown {
            background: #fff !important;
            color: #000 !important;
            border-radius: 8px;
            border: none !important;
            transition: background 0.2s, color 0.2s;
        }
        .nav-link.dropdown-toggle#categoriesDropdown:hover,
        .nav-link.dropdown-toggle#categoriesDropdown:focus,
        .nav-link.dropdown-toggle#categoriesDropdown.show {
            background: #000 !important;
            color: #fff !important;
            border: none !important;
        }
        /* Categories Dropdown Menu - White background, black text */
        .dropdown-menu.categories-menu {
            background: #fff !important;
            color: #000 !important;
            border: 1.5px solid #000 !important;
        }
        .dropdown-menu.categories-menu .dropdown-item,
        .dropdown-menu.categories-menu .dropdown-header,
        .dropdown-menu.categories-menu h6 {
            color: #000 !important;
            background: transparent !important;
        }
        .dropdown-menu.categories-menu .dropdown-item:hover,
        .dropdown-menu.categories-menu .dropdown-item:focus {
            background: #000 !important;
            color: #fff !important;
        }
        /* Dark theme: keep categories button and menu white/black for clarity */
        .dark-theme .nav-link.dropdown-toggle#categoriesDropdown {
            background: #fff !important;
            color: #000 !important;
            border: none !important;
        }
        .dark-theme .nav-link.dropdown-toggle#categoriesDropdown:hover,
        .dark-theme .nav-link.dropdown-toggle#categoriesDropdown:focus,
        .dark-theme .nav-link.dropdown-toggle#categoriesDropdown.show {
            background: #000 !important;
            color: #fff !important;
            border: none !important;
        }
        .dark-theme .dropdown-menu.categories-menu {
            background: #fff !important;
            color: #000 !important;
            border: 1.5px solid #fff !important;
        }
        .dark-theme .dropdown-menu.categories-menu .dropdown-item,
        .dark-theme .dropdown-menu.categories-menu .dropdown-header,
        .dark-theme .dropdown-menu.categories-menu h6 {
            color: #000 !important;
            background: transparent !important;
        }
        .dark-theme .dropdown-menu.categories-menu .dropdown-item:hover,
        .dark-theme .dropdown-menu.categories-menu .dropdown-item:focus {
            background: #000 !important;
            color: #fff !important;
        }

        /* Hamburger Menu Button - White by default, black on hover, no border */
        #hamburgerMenu.btn {
            background: #fff !important;
            color: #000 !important;
            border-radius: 8px;
            border: none !important;
            transition: background 0.2s, color 0.2s;
        }
        #hamburgerMenu.btn:hover,
        #hamburgerMenu.btn:focus,
        #hamburgerMenu.btn.show {
            background: #000 !important;
            color: #fff !important;
            border: none !important;
        }
        /* Hamburger Dropdown Menu - White background, black text */
        .dropdown-menu[aria-labelledby="hamburgerMenu"] {
            background: #fff !important;
            color: #000 !important;
            border: 1.5px solid #000 !important;
        }
        .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-item,
        .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-header,
        .dropdown-menu[aria-labelledby="hamburgerMenu"] h6 {
            color: #000 !important;
            background: transparent !important;
        }
        .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-item:hover,
        .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-item:focus {
            background: #000 !important;
            color: #fff !important;
        }
        /* Dark theme: keep hamburger button and menu white/black for clarity */
        .dark-theme #hamburgerMenu.btn {
            background: #fff !important;
            color: #000 !important;
            border: none !important;
        }
        .dark-theme #hamburgerMenu.btn:hover,
        .dark-theme #hamburgerMenu.btn:focus,
        .dark-theme #hamburgerMenu.btn.show {
            background: #000 !important;
            color: #fff !important;
            border: none !important;
        }
        .dark-theme .dropdown-menu[aria-labelledby="hamburgerMenu"] {
            background: #fff !important;
            color: #000 !important;
            border: 1.5px solid #fff !important;
        }
        .dark-theme .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-item,
        .dark-theme .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-header,
        .dark-theme .dropdown-menu[aria-labelledby="hamburgerMenu"] h6 {
            color: #000 !important;
            background: transparent !important;
        }
        .dark-theme .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-item:hover,
        .dark-theme .dropdown-menu[aria-labelledby="hamburgerMenu"] .dropdown-item:focus {
            background: #000 !important;
            color: #fff !important;
        }

        /* Table row background: always white */
        tr, .table tr, .table > tbody > tr, .table > thead > tr, .table > tfoot > tr {
            background: #fff !important;
        }
        .dark-theme tr, .dark-theme .table tr, .dark-theme .table > tbody > tr, .dark-theme .table > thead > tr, .dark-theme .table > tfoot > tr {
            background: #fff !important;
        }

        /* Table heading background: always white, black text */
        th, .table th, .table > thead > tr > th {
            background: #fff !important;
            color: #000 !important;
        }
        .dark-theme th, .dark-theme .table th, .dark-theme .table > thead > tr > th {
            background: #fff !important;
            color: #000 !important;
        }
    </style>
    <title>NUTRIJUDGE - Multi-Product Comparison</title>
</head>

<body>          
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="src/logo_nav.jpg0000.png" alt="NUTRIJUDGE Logo" class="navbar-logo">
                NUTRIJUDGE
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation menu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html"><i class="fas fa-home me-1"></i>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="comparison.html">Compare</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="categories.html"><i class="fas fa-th-large me-1"></i>Categories</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="blog.html"><i class="fas fa-blog me-1"></i>Blog</a>
                    </li>
                </ul>
            </div>
            <!-- Right side hamburger menu -->
            <div class="navbar-nav ms-auto">
                <div class="dropdown">
                    <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="hamburgerMenu" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Open menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="hamburgerMenu">
                        <li><a class="dropdown-item" href="#" onclick="openAuthModal()"><i class="fas fa-sign-in-alt me-2"></i>Login</a></li>
                        <li><a class="dropdown-item" href="wishlist.html"><i class="fas fa-heart me-2"></i>Wishlist<span class="badge bg-danger ms-2 wishlist-count" style="display: none;">0</span></a></li>
                        <li><a class="dropdown-item" href="cart.html"><i class="fas fa-shopping-cart me-2"></i>Cart<span class="badge bg-primary ms-2 cart-count" style="display: none;">0</span></a></li>
                        <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i>Profile</a></li>
                        <li><a class="dropdown-item" href="#" onclick="openSettingsModal()"><i class="fas fa-cog me-2"></i>Settings</a></li>
                        <li><a class="dropdown-item" href="orders.html"><i class="fas fa-box me-2"></i>Orders</a></li>
                        <li><hr class="dropdown-divider"></li>

                        <li><a class="dropdown-item" href="policies.html"><i class="fas fa-file-contract me-2"></i>Policies</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="https://wa.me/1234567890?text=Hi%20NUTRIJUDGE%20Support,%20I%20need%20help" target="_blank" rel="noopener"><i class="fab fa-whatsapp me-2"></i>WhatsApp Support</a></li>
                        <li><a class="dropdown-item" href="admin.html"><i class="fas fa-user-cog me-2"></i>Admin</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="openContactModal()"><i class="fas fa-phone me-2"></i>Contact Us</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid" style="margin-top: 100px;">
        <!-- Navigation Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="text-center w-100">
                        <h1 class="display-5 mb-0">
                            Multi-Product Comparison Tool
                        </h1>
                    </div>
                </div>
            </div>
        </div>
        <!-- Add Product button removed -->
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="table-responsive">
                    <table class="table table-bordered" id="comparisonTable">
                        <thead>
                            <tr class="bg-light" id="productSelectors">
                                <th scope="col" style="min-width: 200px;">Search Product</th>
                                <th scope="col" class="product-column">
                                    <div class="position-relative">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="searchInput1" placeholder="Search for product..." oninput="handleSearchInput(1, this.value)" onfocus="showSearchResults(1)" onblur="hideSearchResults(1)">
                                        </div>
                                        <div class="search-results-container" id="searchResults1" style="display: none;">
                                            <div class="search-results-list" id="searchResultsList1"></div>
                                        </div>
                                        <button class="remove-product-btn" onclick="removeProductColumn(1)" style="display: none;">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </th>
                                <th scope="col" class="product-column">
                                    <div class="position-relative">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="searchInput2" placeholder="Search for product..." oninput="handleSearchInput(2, this.value)" onfocus="showSearchResults(2)" onblur="hideSearchResults(2)">
                                        </div>
                                        <div class="search-results-container" id="searchResults2" style="display: none;">
                                            <div class="search-results-list" id="searchResultsList2"></div>
                                        </div>
                                        <button class="remove-product-btn" onclick="removeProductColumn(2)" style="display: none;">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="comparisonBody">
                            <tr>
                                <th scope="row">Product Image</th>
                                <td>
                                    <img src=""
                                        id="img1" alt="Product 1 image placeholder" class="img-fluid">
                                </td>
                                <td>
                                    <img src=""
                                        id="img2" alt="Product 2 image placeholder" class="img-fluid">
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">Product Name</th>
                                <td id="title1">N/A</td>
                                <td id="title2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Price</th>
                                <td id="price1">
                                    <div class="price-display">
                                        <div class="current-price">N/A</div>
                                        <div class="original-price" id="originalPrice1" style="display: none;"></div>
                                        <div class="discount-badge" id="discount1" style="display: none;"></div>
                                        <div class="savings-amount" id="savings1" style="display: none;"></div>
                                        <div class="price-per-serving" id="pricePerServing1" style="display: none;"></div>
                                    </div>
                                </td>
                                <td id="price2">
                                    <div class="price-display">
                                        <div class="current-price">N/A</div>
                                        <div class="original-price" id="originalPrice2" style="display: none;"></div>
                                        <div class="discount-badge" id="discount2" style="display: none;"></div>
                                        <div class="savings-amount" id="savings2" style="display: none;"></div>
                                        <div class="price-per-serving" id="pricePerServing2" style="display: none;"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">Brand</th>
                                <td id="brand1">N/A</td>
                                <td id="brand2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Description</th>
                                <td id="desc1">N/A</td>
                                <td id="desc2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Rating</th>
                                <td id="rating1">N/A</td>
                                <td id="rating2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Reviews</th>
                                <td id="reviewCount1">N/A</td>
                                <td id="reviewCount2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Category</th>
                                <td id="category1">N/A</td>
                                <td id="category2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Serving Size</th>
                                <td id="servingSize1">N/A</td>
                                <td id="servingSize2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Servings Per Container</th>
                                <td id="servingsPerContainer1">N/A</td>
                                <td id="servingsPerContainer2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Protein Per Serving</th>
                                <td id="proteinPerServing1">N/A</td>
                                <td id="proteinPerServing2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Calories Per Serving</th>
                                <td id="caloriesPerServing1">N/A</td>
                                <td id="caloriesPerServing2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Stock Status</th>
                                <td id="stock1">N/A</td>
                                <td id="stock2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Shipping</th>
                                <td id="shipping1">N/A</td>
                                <td id="shipping2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Flavors</th>
                                <td id="flavors1">N/A</td>
                                <td id="flavors2">N/A</td>
                            </tr>
                            <tr>
                                <th scope="row">Key Features</th>
                                <td id="keyFeatures1">N/A</td>
                                <td id="keyFeatures2">N/A</td>
                            </tr>
                            <tr class="table-light">
                                <th scope="row">Price Details</th>
                                <td id="priceDetails1">
                                    <div class="small text-muted">
                                        <div id="priceBreakdown1">Select a product to see price details</div>
                                    </div>
                                </td>
                                <td id="priceDetails2">
                                    <div class="small text-muted">
                                        <div id="priceBreakdown2">Select a product to see price details</div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="table-info">
                                <th scope="row">Price Analysis</th>
                                <td colspan="2" id="priceComparison" class="text-center">
                                    <span class="badge bg-secondary">Select products to compare prices</span>
                                </td>
                            </tr>
                            <tr class="table-warning">
                                <th scope="row">Rating Analysis</th>
                                <td colspan="2" id="ratingComparison" class="text-center">
                                    <span class="badge bg-secondary">Select products to compare ratings</span>
                                </td>
                            </tr>
                            <tr class="table-warning">
                                <th scope="row">Actions</th>
                                <td>
                                    <div class="d-grid gap-1">
                                        <button class="btn btn-success btn-sm" onclick="addToCart(1)" id="cartBtn1" disabled>
                                            <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" onclick="addToWishlist(1)" id="wishlistBtn1" disabled>
                                            <i class="fas fa-heart me-1"></i>Wishlist
                                        </button>
                                        <button class="btn btn-primary btn-sm" onclick="buyNow(1)" id="buyNowBtn1" disabled>
                                            <i class="fas fa-bolt me-1"></i>Buy Now
                                        </button>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-grid gap-1">
                                        <button class="btn btn-success btn-sm" onclick="addToCart(2)" id="cartBtn2" disabled>
                                            <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" onclick="addToWishlist(2)" id="wishlistBtn2" disabled>
                                            <i class="fas fa-heart me-1"></i>Wishlist
                                        </button>
                                        <button class="btn btn-primary btn-sm" onclick="buyNow(2)" id="buyNowBtn2" disabled>
                                            <i class="fas fa-bolt me-1"></i>Buy Now
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.0/js/bootstrap.min.js"></script>
    <script src="src/data.js"></script>
    <script src="src/unifiedLogin.js"></script>
    <script src="main.js"></script>
    
    <script>
        let productCount = 2;
        const maxProducts = 2;
        let currentStep = 1;
        const totalSteps = 4;
        
        // Add new product column
        function addProductColumn() {
            console.log('addProductColumn called, current count:', productCount);
            
            if (productCount >= maxProducts) {
                showNotification('Maximum 2 products can be compared at once!', 'warning');
                return;
            }
            
            productCount++;
            const columnIndex = productCount;
            console.log('Adding product column:', columnIndex);
            
            // Add selector column
            const selectorRow = document.getElementById('productSelectors');
            if (!selectorRow) {
                console.error('productSelectors not found');
                showNotification('Error: Could not find product selectors', 'error');
                return;
            }
            
            const newSelectorCell = document.createElement('th');
            newSelectorCell.className = 'product-column';
            newSelectorCell.innerHTML = `
                <div class="position-relative">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput${columnIndex}" placeholder="Search for product..." oninput="handleSearchInput(${columnIndex}, this.value)" onfocus="showSearchResults(${columnIndex})" onblur="hideSearchResults(${columnIndex})">
                    </div>
                    <div class="search-results-container" id="searchResults${columnIndex}" style="display: none;">
                        <div class="search-results-list" id="searchResultsList${columnIndex}"></div>
                    </div>
                    <button class="remove-product-btn" onclick="removeProductColumn(${columnIndex})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            selectorRow.appendChild(newSelectorCell);
            
            // Add data rows
            const tbody = document.getElementById('comparisonBody');
            if (!tbody) {
                console.error('comparisonBody not found');
                showNotification('Error: Could not find comparison body', 'error');
                return;
            }
            
            const rows = tbody.children;
            
            // Image row
            const imageCell = document.createElement('td');
            imageCell.innerHTML = `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/1665px-No-Image-Placeholder.svg.png" id="img${columnIndex}" alt="Product ${columnIndex} image placeholder" class="img-fluid">`;
            rows[0].appendChild(imageCell);
            
            // Price row
            const priceCell = document.createElement('td');
            priceCell.id = `price${columnIndex}`;
            priceCell.innerHTML = `
                <div class="price-display">
                    <div class="current-price">N/A</div>
                    <div class="original-price" id="originalPrice${columnIndex}" style="display: none;"></div>
                    <div class="discount-badge" id="discount${columnIndex}" style="display: none;"></div>
                    <div class="savings-amount" id="savings${columnIndex}" style="display: none;"></div>
                    <div class="price-per-serving" id="pricePerServing${columnIndex}" style="display: none;"></div>
                </div>
            `;
            rows[1].appendChild(priceCell);
            
            // Price comparison row
            const comparisonCell = rows[2].querySelector('td');
            comparisonCell.colSpan = productCount;
            
            // Description row
            const descCell = document.createElement('td');
            descCell.id = `desc${columnIndex}`;
            descCell.textContent = 'N/A';
            rows[3].appendChild(descCell);
            
            // Brand row
            const brandCell = document.createElement('td');
            brandCell.id = `brand${columnIndex}`;
            brandCell.textContent = 'N/A';
            rows[4].appendChild(brandCell);
            
            // Category row
            const categoryCell = document.createElement('td');
            categoryCell.id = `category${columnIndex}`;
            categoryCell.textContent = 'N/A';
            rows[5].appendChild(categoryCell);
            
            // Serving Size row
            const servingSizeCell = document.createElement('td');
            servingSizeCell.id = `servingSize${columnIndex}`;
            servingSizeCell.textContent = 'N/A';
            rows[6].appendChild(servingSizeCell);
            
            // Servings Per Container row
            const servingsPerContainerCell = document.createElement('td');
            servingsPerContainerCell.id = `servingsPerContainer${columnIndex}`;
            servingsPerContainerCell.textContent = 'N/A';
            rows[7].appendChild(servingsPerContainerCell);
            
            // Protein Per Serving row
            const proteinPerServingCell = document.createElement('td');
            proteinPerServingCell.id = `proteinPerServing${columnIndex}`;
            proteinPerServingCell.textContent = 'N/A';
            rows[8].appendChild(proteinPerServingCell);
            
            // Calories Per Serving row
            const caloriesPerServingCell = document.createElement('td');
            caloriesPerServingCell.id = `caloriesPerServing${columnIndex}`;
            caloriesPerServingCell.textContent = 'N/A';
            rows[9].appendChild(caloriesPerServingCell);
            
            // Price Per Serving row
            const pricePerServingCell = document.createElement('td');
            pricePerServingCell.id = `pricePerServing${columnIndex}`;
            pricePerServingCell.textContent = 'N/A';
            rows[10].appendChild(pricePerServingCell);
            
            // Caffeine Per Serving row
            const caffeinePerServingCell = document.createElement('td');
            caffeinePerServingCell.id = `caffeinePerServing${columnIndex}`;
            caffeinePerServingCell.textContent = 'N/A';
            rows[11].appendChild(caffeinePerServingCell);
            
            // Creatine Per Serving row
            const creatinePerServingCell = document.createElement('td');
            creatinePerServingCell.id = `creatinePerServing${columnIndex}`;
            creatinePerServingCell.textContent = 'N/A';
            rows[12].appendChild(creatinePerServingCell);
            
            // BCAA Ratio row
            const bcaaRatioCell = document.createElement('td');
            bcaaRatioCell.id = `bcaaRatio${columnIndex}`;
            bcaaRatioCell.textContent = 'N/A';
            rows[13].appendChild(bcaaRatioCell);
            
            // Extract Ratio row
            const extractRatioCell = document.createElement('td');
            extractRatioCell.id = `extractRatio${columnIndex}`;
            extractRatioCell.textContent = 'N/A';
            rows[14].appendChild(extractRatioCell);
            
            // EPA Content row
            const epaContentCell = document.createElement('td');
            epaContentCell.id = `epaContent${columnIndex}`;
            epaContentCell.textContent = 'N/A';
            rows[15].appendChild(epaContentCell);
            
            // DHA Content row
            const dhaContentCell = document.createElement('td');
            dhaContentCell.id = `dhaContent${columnIndex}`;
            dhaContentCell.textContent = 'N/A';
            rows[16].appendChild(dhaContentCell);
            
            // Vitamin D Content row
            const vitaminDContentCell = document.createElement('td');
            vitaminDContentCell.id = `vitaminDContent${columnIndex}`;
            vitaminDContentCell.textContent = 'N/A';
            rows[17].appendChild(vitaminDContentCell);
            
            // Magnesium Content row
            const magnesiumContentCell = document.createElement('td');
            magnesiumContentCell.id = `magnesiumContent${columnIndex}`;
            magnesiumContentCell.textContent = 'N/A';
            rows[18].appendChild(magnesiumContentCell);
            
            // Zinc Content row
            const zincContentCell = document.createElement('td');
            zincContentCell.id = `zincContent${columnIndex}`;
            zincContentCell.textContent = 'N/A';
            rows[19].appendChild(zincContentCell);
            
            // Collagen Content row
            const collagenContentCell = document.createElement('td');
            collagenContentCell.id = `collagenContent${columnIndex}`;
            collagenContentCell.textContent = 'N/A';
            rows[20].appendChild(collagenContentCell);
            
            // Probiotic Strains row
            const probioticStrainsCell = document.createElement('td');
            probioticStrainsCell.id = `probioticStrains${columnIndex}`;
            probioticStrainsCell.textContent = 'N/A';
            rows[21].appendChild(probioticStrainsCell);
            
            // EGCG Content row
            const egcgContentCell = document.createElement('td');
            egcgContentCell.id = `egcgContent${columnIndex}`;
            egcgContentCell.textContent = 'N/A';
            rows[22].appendChild(egcgContentCell);
            
            // Glutamine Content row
            const glutamineContentCell = document.createElement('td');
            glutamineContentCell.id = `glutamineContent${columnIndex}`;
            glutamineContentCell.textContent = 'N/A';
            rows[23].appendChild(glutamineContentCell);
            
            // Vitamin Count row
            const vitaminCountCell = document.createElement('td');
            vitaminCountCell.id = `vitaminCount${columnIndex}`;
            vitaminCountCell.textContent = 'N/A';
            rows[24].appendChild(vitaminCountCell);
            
            // B Vitamin Content row
            const bVitaminContentCell = document.createElement('td');
            bVitaminContentCell.id = `bVitaminContent${columnIndex}`;
            bVitaminContentCell.textContent = 'N/A';
            rows[25].appendChild(bVitaminContentCell);
            
            // Withania Somnifera row
            const withaniaSomniferaCell = document.createElement('td');
            withaniaSomniferaCell.id = `withaniaSomnifera${columnIndex}`;
            withaniaSomniferaCell.textContent = 'N/A';
            rows[26].appendChild(withaniaSomniferaCell);
            
            // Stock Status row
            const stockCell = document.createElement('td');
            stockCell.id = `stock${columnIndex}`;
            stockCell.textContent = 'N/A';
            rows[27].appendChild(stockCell);
            
            // Shipping row
            const shippingCell = document.createElement('td');
            shippingCell.id = `shipping${columnIndex}`;
            shippingCell.textContent = 'N/A';
            rows[28].appendChild(shippingCell);
            
            // Flavors row
            const flavorsCell = document.createElement('td');
            flavorsCell.id = `flavors${columnIndex}`;
            flavorsCell.textContent = 'N/A';
            rows[30].appendChild(flavorsCell);
            
            // Key Features row
            const keyFeaturesCell = document.createElement('td');
            keyFeaturesCell.id = `keyFeatures${columnIndex}`;
            keyFeaturesCell.textContent = 'N/A';
            rows[31].appendChild(keyFeaturesCell);
            
            // Price Details row
            const priceDetailsCell = document.createElement('td');
            priceDetailsCell.id = `priceDetails${columnIndex}`;
            priceDetailsCell.innerHTML = `
                <div class="small text-muted">
                    <div id="priceBreakdown${columnIndex}">Select a product to see price details</div>
                </div>
            `;
            rows[32].appendChild(priceDetailsCell);
            
            // Price comparison row
            const priceComparisonCell = rows[33].querySelector('td');
            priceComparisonCell.colSpan = productCount;
            
            // Rating comparison row
            const ratingComparisonCell = rows[34].querySelector('td');
            ratingComparisonCell.colSpan = productCount;
            
            // Actions row (Cart, Wishlist buttons)
            const actionsCell = document.createElement('td');
            actionsCell.innerHTML = `
                <div class="d-grid gap-1">
                    <button class="btn btn-success btn-sm" onclick="addToCart(${columnIndex})" id="cartBtn${columnIndex}" disabled>
                        <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                    </button>
                    <button class="btn btn-outline-primary btn-sm" onclick="addToWishlist(${columnIndex})" id="wishlistBtn${columnIndex}" disabled>
                        <i class="fas fa-heart me-1"></i>Wishlist
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="buyNow(${columnIndex})" id="buyNowBtn${columnIndex}" disabled>
                        <i class="fas fa-bolt me-1"></i>Buy Now
                    </button>
                </div>
            `;
            rows[35].appendChild(actionsCell);
            
            // Update add button state
            updateAddButtonState();
            
            // Populate select options with actual product data
            populateSelectOptions(columnIndex);
            
            // Show success notification
            showNotification(`Product column ${columnIndex} added successfully! You can now compare up to ${productCount} products.`, 'success');
            
            // Update comparisons
            setTimeout(() => {
                comparePrices();
                compareRatings();
            }, 100);
            
            console.log('Product column added successfully');
        }
        
        // Update add button state
        function updateAddButtonState() {
            const addBtn = document.getElementById('addProductBtn');
            if (addBtn) {
                if (productCount >= maxProducts) {
                    addBtn.disabled = true;
                    addBtn.innerHTML = '<i class="fas fa-ban me-1"></i>Max Reached (2 Products)';
                    addBtn.classList.remove('add-product-btn');
                    addBtn.classList.add('btn-secondary');
                } else {
                    addBtn.disabled = false;
                    addBtn.innerHTML = `<i class="fas fa-plus me-1"></i>Add Product (${productCount}/${maxProducts})`;
                    addBtn.classList.remove('btn-secondary');
                    addBtn.classList.add('add-product-btn');
                }
            }
        }
        
        // Remove product column
        function removeProductColumn(columnIndex) {
            if (productCount <= 2) {
                showNotification('Minimum 2 products required for comparison!', 'warning');
                return;
            }
            
            // Remove selector column
            const selectorRow = document.getElementById('productSelectors');
            selectorRow.children[columnIndex].remove();
            
            // Remove data columns
            const tbody = document.getElementById('comparisonBody');
            const rows = tbody.children;
            
            for (let i = 0; i < rows.length; i++) {
                if (i === 33) { // Price comparison row
                    const comparisonCell = rows[i].querySelector('td');
                    comparisonCell.colSpan = productCount - 1;
                } else if (i === 34) { // Rating comparison row
                    const ratingComparisonCell = rows[i].querySelector('td');
                    ratingComparisonCell.colSpan = productCount - 1;
                } else {
                    rows[i].children[columnIndex].remove();
                }
            }
            
            productCount--;
            
            // Update add button state
            updateAddButtonState();
            
            // Reorder remaining columns
            reorderColumns();
            
            // Update price comparison
            comparePrices();
            
            // Show notification
            showNotification(`Product column removed. Now comparing ${productCount} products.`, 'info');
        }
        
        // Reorder columns after removal
        function reorderColumns() {
            const selectors = document.querySelectorAll('[id^="select"]');
            const images = document.querySelectorAll('[id^="img"]');
            const prices = document.querySelectorAll('[id^="price"]');
            const descs = document.querySelectorAll('[id^="desc"]');
            const brands = document.querySelectorAll('[id^="brand"]');
            const categories = document.querySelectorAll('[id^="category"]');
            const servingSizes = document.querySelectorAll('[id^="servingSize"]');
            const servingsPerContainer = document.querySelectorAll('[id^="servingsPerContainer"]');
            const proteinPerServing = document.querySelectorAll('[id^="proteinPerServing"]');
            const caloriesPerServing = document.querySelectorAll('[id^="caloriesPerServing"]');
            const pricePerServing = document.querySelectorAll('[id^="pricePerServing"]');
            const caffeinePerServing = document.querySelectorAll('[id^="caffeinePerServing"]');
            const creatinePerServing = document.querySelectorAll('[id^="creatinePerServing"]');
            const bcaaRatio = document.querySelectorAll('[id^="bcaaRatio"]');
            const extractRatio = document.querySelectorAll('[id^="extractRatio"]');
            const epaContent = document.querySelectorAll('[id^="epaContent"]');
            const dhaContent = document.querySelectorAll('[id^="dhaContent"]');
            const vitaminDContent = document.querySelectorAll('[id^="vitaminDContent"]');
            const magnesiumContent = document.querySelectorAll('[id^="magnesiumContent"]');
            const zincContent = document.querySelectorAll('[id^="zincContent"]');
            const collagenContent = document.querySelectorAll('[id^="collagenContent"]');
            const probioticStrains = document.querySelectorAll('[id^="probioticStrains"]');
            const egcgContent = document.querySelectorAll('[id^="egcgContent"]');
            const glutamineContent = document.querySelectorAll('[id^="glutamineContent"]');
            const vitaminCount = document.querySelectorAll('[id^="vitaminCount"]');
            const bVitaminContent = document.querySelectorAll('[id^="bVitaminContent"]');
            const withaniaSomnifera = document.querySelectorAll('[id^="withaniaSomnifera"]');
            const stock = document.querySelectorAll('[id^="stock"]');
            const shipping = document.querySelectorAll('[id^="shipping"]');
            const keyFeatures = document.querySelectorAll('[id^="keyFeatures"]');
            const flavors = document.querySelectorAll('[id^="flavors"]');
            const reviewCounts = document.querySelectorAll('[id^="reviewCount"]');
            const ratings = document.querySelectorAll('[id^="rating"]');
            
            selectors.forEach((selector, index) => {
                const newIndex = index + 1;
                selector.id = `select${newIndex}`;
                selector.setAttribute('onchange', `updateProduct(${newIndex}, this.value)`);
                selector.setAttribute('aria-label', `Select product ${newIndex} for comparison`);
                selector.querySelector('option').textContent = `-- Select Product ${newIndex} --`;
            });
            
            images.forEach((img, index) => {
                const newIndex = index + 1;
                img.id = `img${newIndex}`;
                img.alt = `Product ${newIndex} image placeholder`;
            });
            
            prices.forEach((price, index) => {
                const newIndex = index + 1;
                price.id = `price${newIndex}`;
            });
            
            descs.forEach((desc, index) => {
                const newIndex = index + 1;
                desc.id = `desc${newIndex}`;
            });
            
            brands.forEach((brand, index) => {
                const newIndex = index + 1;
                brand.id = `brand${newIndex}`;
            });
            
            categories.forEach((category, index) => {
                const newIndex = index + 1;
                category.id = `category${newIndex}`;
            });
            
            servingSizes.forEach((servingSize, index) => {
                const newIndex = index + 1;
                servingSize.id = `servingSize${newIndex}`;
            });
            
            servingsPerContainer.forEach((servingsPerContainer, index) => {
                const newIndex = index + 1;
                servingsPerContainer.id = `servingsPerContainer${newIndex}`;
            });
            
            proteinPerServing.forEach((proteinPerServing, index) => {
                const newIndex = index + 1;
                proteinPerServing.id = `proteinPerServing${newIndex}`;
            });
            
            caloriesPerServing.forEach((caloriesPerServing, index) => {
                const newIndex = index + 1;
                caloriesPerServing.id = `caloriesPerServing${newIndex}`;
            });
            
            keyFeatures.forEach((keyFeatures, index) => {
                const newIndex = index + 1;
                keyFeatures.id = `keyFeatures${newIndex}`;
            });
            
            flavors.forEach((flavors, index) => {
                const newIndex = index + 1;
                flavors.id = `flavors${newIndex}`;
            });
            
            reviewCounts.forEach((reviewCount, index) => {
                const newIndex = index + 1;
                reviewCount.id = `reviewCount${newIndex}`;
            });
            
            ratings.forEach((rating, index) => {
                const newIndex = index + 1;
                rating.id = `rating${newIndex}`;
            });
            
            // Reorder new fields
            pricePerServing.forEach((pricePerServing, index) => {
                const newIndex = index + 1;
                pricePerServing.id = `pricePerServing${newIndex}`;
            });
            
            caffeinePerServing.forEach((caffeinePerServing, index) => {
                const newIndex = index + 1;
                caffeinePerServing.id = `caffeinePerServing${newIndex}`;
            });
            
            creatinePerServing.forEach((creatinePerServing, index) => {
                const newIndex = index + 1;
                creatinePerServing.id = `creatinePerServing${newIndex}`;
            });
            
            bcaaRatio.forEach((bcaaRatio, index) => {
                const newIndex = index + 1;
                bcaaRatio.id = `bcaaRatio${newIndex}`;
            });
            
            extractRatio.forEach((extractRatio, index) => {
                const newIndex = index + 1;
                extractRatio.id = `extractRatio${newIndex}`;
            });
            
            epaContent.forEach((epaContent, index) => {
                const newIndex = index + 1;
                epaContent.id = `epaContent${newIndex}`;
            });
            
            dhaContent.forEach((dhaContent, index) => {
                const newIndex = index + 1;
                dhaContent.id = `dhaContent${newIndex}`;
            });
            
            vitaminDContent.forEach((vitaminDContent, index) => {
                const newIndex = index + 1;
                vitaminDContent.id = `vitaminDContent${newIndex}`;
            });
            
            magnesiumContent.forEach((magnesiumContent, index) => {
                const newIndex = index + 1;
                magnesiumContent.id = `magnesiumContent${newIndex}`;
            });
            
            zincContent.forEach((zincContent, index) => {
                const newIndex = index + 1;
                zincContent.id = `zincContent${newIndex}`;
            });
            
            collagenContent.forEach((collagenContent, index) => {
                const newIndex = index + 1;
                collagenContent.id = `collagenContent${newIndex}`;
            });
            
            probioticStrains.forEach((probioticStrains, index) => {
                const newIndex = index + 1;
                probioticStrains.id = `probioticStrains${newIndex}`;
            });
            
            egcgContent.forEach((egcgContent, index) => {
                const newIndex = index + 1;
                egcgContent.id = `egcgContent${newIndex}`;
            });
            
            glutamineContent.forEach((glutamineContent, index) => {
                const newIndex = index + 1;
                glutamineContent.id = `glutamineContent${newIndex}`;
            });
            
            vitaminCount.forEach((vitaminCount, index) => {
                const newIndex = index + 1;
                vitaminCount.id = `vitaminCount${newIndex}`;
            });
            
            bVitaminContent.forEach((bVitaminContent, index) => {
                const newIndex = index + 1;
                bVitaminContent.id = `bVitaminContent${newIndex}`;
            });
            
            withaniaSomnifera.forEach((withaniaSomnifera, index) => {
                const newIndex = index + 1;
                withaniaSomnifera.id = `withaniaSomnifera${newIndex}`;
            });
            
            stock.forEach((stock, index) => {
                const newIndex = index + 1;
                stock.id = `stock${newIndex}`;
            });
            
            shipping.forEach((shipping, index) => {
                const newIndex = index + 1;
                shipping.id = `shipping${newIndex}`;
            });
        }
        
        // Update product data
        function updateProduct(columnIndex, value) {
            console.log(`updateProduct called: column ${columnIndex}, value ${value}`);
            
            // Update with product data if value is not 0
            if (value !== "0" && value !== 0) {
                const productId = parseInt(value);
                console.log(`Updating product data for column ${columnIndex}, product ID: ${productId}`);
                updateProductData(columnIndex, productId);
                
                // Enable buttons
                enableProductButtons(columnIndex);
            } else {
                console.log(`Resetting column ${columnIndex} to default values`);
                resetProductColumn(columnIndex);
            }
            
            // Update comparisons in real-time
            setTimeout(() => {
                comparePrices();
                compareRatings();
            }, 100);
        }
        
        // Enable product buttons
        function enableProductButtons(columnIndex) {
            const cartBtn = document.getElementById(`cartBtn${columnIndex}`);
            const wishlistBtn = document.getElementById(`wishlistBtn${columnIndex}`);
            const buyNowBtn = document.getElementById(`buyNowBtn${columnIndex}`);
            
            if (cartBtn) {
                cartBtn.disabled = false;
                cartBtn.classList.remove('btn-secondary');
                cartBtn.classList.add('btn-success');
            }
            
            if (wishlistBtn) {
                wishlistBtn.disabled = false;
                wishlistBtn.classList.remove('btn-secondary');
                wishlistBtn.classList.add('btn-outline-primary');
            }
            
            if (buyNowBtn) {
                buyNowBtn.disabled = false;
                buyNowBtn.classList.remove('btn-secondary');
                buyNowBtn.classList.add('btn-primary');
            }
        }
        
        // Reset product column to default state
        function resetProductColumn(columnIndex) {
            // Reset image
            const imageElement = document.getElementById(`img${columnIndex}`);
            if (imageElement) {
                imageElement.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/1665px-No-Image-Placeholder.svg.png";
                imageElement.alt = `Product ${columnIndex} image placeholder`;
            }
            
            // Reset price display
            resetProductPrice(columnIndex);
            
            // Reset all product details
            const elementsToReset = [
                'title', 'desc', 'brand', 'category', 'servingSize', 
                'servingsPerContainer', 'proteinPerServing', 'caloriesPerServing',
                'pricePerServing', 'caffeinePerServing', 'creatinePerServing',
                'bcaaRatio', 'extractRatio', 'epaContent', 'dhaContent',
                'vitaminDContent', 'magnesiumContent', 'zincContent',
                'collagenContent', 'probioticStrains', 'egcgContent',
                'glutamineContent', 'vitaminCount', 'bVitaminContent',
                'withaniaSomnifera', 'stock', 'shipping', 'warranty',
                'keyFeatures', 'flavors', 'reviewCount', 'rating'
            ];
            
            elementsToReset.forEach(elementId => {
                const element = document.getElementById(`${elementId}${columnIndex}`);
                if (element) {
                    if (elementId === 'keyFeatures' || elementId === 'flavors') {
                        element.innerHTML = "N/A";
                    } else {
                        element.textContent = "N/A";
                    }
                }
            });
            
            // Reset price breakdown
            const priceBreakdown = document.getElementById(`priceBreakdown${columnIndex}`);
            if (priceBreakdown) {
                priceBreakdown.textContent = "Select a product to see price details";
            }
            
            // Disable all buttons
            const cartBtn = document.getElementById(`cartBtn${columnIndex}`);
            const wishlistBtn = document.getElementById(`wishlistBtn${columnIndex}`);
            const buyNowBtn = document.getElementById(`buyNowBtn${columnIndex}`);
            
            if (cartBtn) {
                cartBtn.disabled = true;
                cartBtn.innerHTML = '<i class="fas fa-shopping-cart me-1"></i>Add to Cart';
                cartBtn.classList.remove('btn-success');
                cartBtn.classList.add('btn-secondary');
            }
            
            if (wishlistBtn) {
                wishlistBtn.disabled = true;
                wishlistBtn.innerHTML = '<i class="fas fa-heart me-1"></i>Wishlist';
                wishlistBtn.classList.remove('btn-outline-primary');
                wishlistBtn.classList.add('btn-secondary');
            }
            
            if (buyNowBtn) {
                buyNowBtn.disabled = true;
                buyNowBtn.innerHTML = '<i class="fas fa-bolt me-1"></i>Buy Now';
                buyNowBtn.classList.remove('btn-primary');
                buyNowBtn.classList.add('btn-secondary');
            }
        }
        
        // Generate star rating display
        function generateStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let starsHTML = '';
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                starsHTML += '<i class="fas fa-star text-warning"></i>';
            }
            
            // Half star
            if (hasHalfStar) {
                starsHTML += '<i class="fas fa-star-half-alt text-warning"></i>';
            }
            
            // Empty stars
            for (let i = 0; i < emptyStars; i++) {
                starsHTML += '<i class="far fa-star text-warning"></i>';
            }
            
            return `${starsHTML} <span class="ms-2 fw-bold">${rating.toFixed(1)}</span>`;
        }
        
        // Reset product price display
        function resetProductPrice(columnIndex) {
            const priceElement = document.getElementById(`price${columnIndex}`);
            if (priceElement) {
                priceElement.innerHTML = `
                    <div class="price-display">
                        <div class="current-price">N/A</div>
                        <div class="original-price" id="originalPrice${columnIndex}" style="display: none;"></div>
                        <div class="discount-badge" id="discount${columnIndex}" style="display: none;"></div>
                        <div class="savings-amount" id="savings${columnIndex}" style="display: none;"></div>
                        <div class="price-per-serving" id="pricePerServing${columnIndex}" style="display: none;"></div>
                    </div>
                `;
            }
        }
        
        // Update product price display
        function updateProductPrice(columnIndex, product) {
            const priceElement = document.getElementById(`price${columnIndex}`);
            if (!priceElement) return;
            
            const price = product.price || 'N/A';
            const originalPrice = product.originalPrice || null;
            const discount = product.discount || null;
            
            let priceHTML = `<div class="price-display">`;
            priceHTML += `<div class="current-price">${price}</div>`;
            
            if (originalPrice && originalPrice !== price) {
                const savings = parseFloat(originalPrice.replace(/[^0-9,]/g, '').replace(',', '')) - parseFloat(price.replace(/[^0-9,]/g, '').replace(',', ''));
                priceHTML += `<div class="original-price">${originalPrice}</div>`;
                priceHTML += `<div class="savings-amount">Save ${savings.toLocaleString()}</div>`;
            }
            
            if (discount) {
                priceHTML += `<div class="discount-badge">${discount} OFF</div>`;
            }
            
            if (product.servingsPerContainer && product.servingsPerContainer > 0) {
                const pricePerServing = (parseFloat(price.replace(/[^0-9,]/g, '').replace(',', '')) / product.servingsPerContainer).toFixed(2);
                priceHTML += `<div class="price-per-serving">${pricePerServing}/serving</div>`;
            }
            
            priceHTML += `</div>`;
            priceElement.innerHTML = priceHTML;
        }
        
        // Enhanced price comparison for multiple products
        function comparePrices() {
            const prices = [];
            const validPrices = [];
            const pricePerServingData = [];
            
            // Collect all prices and price per serving data
            for (let i = 1; i <= productCount; i++) {
                const priceElement = document.getElementById(`price${i}`);
                const priceText = priceElement.textContent;
                const pricePerServingElement = document.getElementById(`pricePerServing${i}`);
                const pricePerServingText = pricePerServingElement ? pricePerServingElement.textContent : '';
                
                prices.push(priceText);
                
                if (priceText !== 'N/A') {
                    const price = parseFloat(priceText.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                    if (!isNaN(price) && price > 0) {
                        validPrices.push({ index: i, price: price });
                        
                        // Extract price per serving if available
                        if (pricePerServingText && pricePerServingText !== 'N/A') {
                            const pricePerServing = parseFloat(pricePerServingText.match(/([0-9.]+)/)?.[1]) || 0;
                            if (pricePerServing > 0) {
                                pricePerServingData.push({ index: i, pricePerServing: pricePerServing });
                            }
                        }
                    }
                }
            }
            
            const comparisonElement = document.getElementById('priceComparison');
            
            if (validPrices.length < 2) {
                comparisonElement.innerHTML = '<span class="badge bg-secondary">Select at least 2 products to compare prices</span>';
                return;
            }
            
            // Find cheapest and most expensive
            const sortedPrices = validPrices.sort((a, b) => a.price - b.price);
            const cheapest = sortedPrices[0];
            const mostExpensive = sortedPrices[sortedPrices.length - 1];
            const priceRange = mostExpensive.price - cheapest.price;
            const savingsPercentage = ((priceRange / mostExpensive.price) * 100).toFixed(1);
            
            // Highlight cheapest and most expensive prices
            document.querySelectorAll('[id^="price"]').forEach(el => {
                el.classList.remove('price-highlight-best', 'price-highlight-expensive');
            });
            
            if (cheapest.index <= productCount) {
                document.getElementById(`price${cheapest.index}`).classList.add('price-highlight-best');
            }
            
            if (mostExpensive.index <= productCount && mostExpensive.index !== cheapest.index) {
                document.getElementById(`price${mostExpensive.index}`).classList.add('price-highlight-expensive');
            }
            
            // Generate comparison HTML
            let comparisonHTML = `
                <div class="d-flex flex-wrap align-items-center justify-content-center gap-2">
                    <span class="badge bg-success">Product ${cheapest.index} is cheapest</span>
                    <span class="badge bg-info">${priceRange.toFixed(0)} price range</span>
                    <span class="badge bg-warning">${savingsPercentage}% potential savings</span>
                </div>
            `;
            
            // Add price per serving comparison if available
            if (pricePerServingData.length >= 2) {
                const sortedPricePerServing = pricePerServingData.sort((a, b) => a.pricePerServing - b.pricePerServing);
                const cheapestPerServing = sortedPricePerServing[0];
                const mostExpensivePerServing = sortedPricePerServing[sortedPricePerServingData.length - 1];
                
                comparisonHTML += `
                    <div class="mt-2 d-flex flex-wrap align-items-center justify-content-center gap-2">
                        <span class="badge bg-primary">Best value per serving: Product ${cheapestPerServing.index}</span>
                        <span class="badge bg-secondary">${cheapestPerServing.pricePerServing.toFixed(2)}/serving</span>
                    </div>
                `;
            }
            
            if (validPrices.length > 2) {
                const avgPrice = validPrices.reduce((sum, item) => sum + item.price, 0) / validPrices.length;
                comparisonHTML += `
                    <div class="mt-2">
                        <small class="text-muted">Average price: ${avgPrice.toFixed(0)}</small>
                    </div>
                `;
            }
            
            comparisonElement.innerHTML = comparisonHTML;
        }
        
        // Rating comparison for multiple products
        function compareRatings() {
            const ratings = [];
            const validRatings = [];
            
            // Collect all ratings
            for (let i = 1; i <= productCount; i++) {
                const ratingElement = document.getElementById(`rating${i}`);
                const ratingText = ratingElement.textContent;
                ratings.push(ratingText);
                
                if (ratingText !== 'N/A') {
                    // Extract numeric rating from the text (e.g., "4.8" from " 4.8")
                    const ratingMatch = ratingText.match(/(\d+\.\d+)/);
                    if (ratingMatch) {
                        const rating = parseFloat(ratingMatch[1]);
                        validRatings.push({ index: i, rating: rating });
                    }
                }
            }
            
            const comparisonElement = document.getElementById('ratingComparison');
            
            if (validRatings.length < 2) {
                comparisonElement.innerHTML = '<span class="badge bg-secondary">Select at least 2 products to compare ratings</span>';
                return;
            }
            
            // Find highest and lowest rated
            const sortedRatings = validRatings.sort((a, b) => b.rating - a.rating);
            const highest = sortedRatings[0];
            const lowest = sortedRatings[sortedRatings.length - 1];
            const ratingDifference = highest.rating - lowest.rating;
            
            // Highlight highest rating
            document.querySelectorAll('[id^="rating"]').forEach(el => {
                el.classList.remove('rating-highlight', 'rating-warning');
            });
            
            if (highest.index <= productCount) {
                document.getElementById(`rating${highest.index}`).classList.add('rating-highlight');
            }
            
            // Generate comparison HTML
            let comparisonHTML = `
                <div class="d-flex flex-wrap align-items-center justify-content-center gap-2">
                    <span class="badge bg-success">Product ${highest.index} has highest rating</span>
                    <span class="badge bg-info">${ratingDifference.toFixed(1)} rating difference</span>
                    <span class="badge bg-warning">${(ratingDifference * 20).toFixed(0)}% quality gap</span>
                </div>
            `;
            
            if (validRatings.length > 2) {
                const avgRating = validRatings.reduce((sum, item) => sum + item.rating, 0) / validRatings.length;
                comparisonHTML += `
                    <div class="mt-2">
                        <small class="text-muted">Average rating: ${avgRating.toFixed(1)}/5.0</small>
                    </div>
                `;
            }
            
            comparisonElement.innerHTML = comparisonHTML;
        }
        
                // Populate select options with sample products
        function populateSelectOptions(columnIndex) {
            console.log('populateSelectOptions called for column:', columnIndex);
            
            const selectElement = document.getElementById(`select${columnIndex}`);
            if (!selectElement) {
                console.error(`select${columnIndex} element not found`);
                return;
            }
            
            // Get products from data.js or use fallback
            const products = window.product || [];
            console.log('Products loaded from data.js:', products.length, 'products');
            
            // Clear existing options except the first one
            while (selectElement.children.length > 1) {
                selectElement.removeChild(selectElement.lastChild);
            }
            
            if (products.length === 0) {
                console.warn('No products found in data.js, using fallback data');
                // Fallback products if data.js is not loaded
                const fallbackProducts = [
                    { id: 1, title: "Whey Protein Isolate", price: "3,499", brand: "MuscleMax Pro" },
                    { id: 2, title: "Mass Gainer Pro", price: "2,999", brand: "BulkSupplements" },
                    { id: 3, title: "Pre-Workout Explosion", price: "1,899", brand: "PowerFuel" },
                    { id: 4, title: "BCAA Recovery", price: "1,599", brand: "RecoveryPlus" },
                    { id: 5, title: "Ashwagandha KSM-66", price: "1,299", brand: "AyurVeda Pro" },
                    { id: 6, title: "Creatine Monohydrate", price: "1,799", brand: "PowerFuel" },
                    { id: 7, title: "Omega-3 Fish Oil", price: "2,099", brand: "PureHealth" },
                    { id: 8, title: "Vitamin D3", price: "1,599", brand: "SunVit" },
                    { id: 9, title: "Magnesium Complex", price: "2,299", brand: "MineralMax" },
                    { id: 10, title: "B-Complex Vitamins", price: "1,899", brand: "VitaLife" },
                    { id: 11, title: "Zinc Supplement", price: "1,299", brand: "MineralMax" },
                    { id: 12, title: "Collagen Peptides", price: "3,299", brand: "BeautySupp" }
                ];
                
                // Clear existing options except the first one
                while (selectElement.children.length > 1) {
                    selectElement.removeChild(selectElement.lastChild);
                }
                
                // Add fallback product options
                fallbackProducts.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.title} - ${product.price}`;
                    selectElement.appendChild(option);
                });
                
                console.log('Fallback products loaded:', fallbackProducts.length, 'products');
                return;
            }
            
            // Clear existing options except the first one
            while (selectElement.children.length > 1) {
                selectElement.removeChild(selectElement.lastChild);
            }
            
            // Add product options from data.js with category information
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                const categoryText = product.category ? ` (${product.category.charAt(0).toUpperCase() + product.category.slice(1)})` : '';
                option.textContent = `${product.title}${categoryText} - ${product.price}`;
                selectElement.appendChild(option);
            });
            
            console.log('Select options populated successfully with', products.length, 'products');
        }
        
        // Enhanced product data update function using actual data
        function updateProductData(columnIndex, productId) {
            console.log(`Updating product data for column ${columnIndex}, product ID: ${productId}`);
            
            // Get product from data.js or use fallback
            const products = window.product || [];
            console.log('Available products:', products.length);
            
            const product = products.find(p => p.id === productId);
            
            if (product) {
                console.log(' Product found:', product.title);
                console.log('Product price:', product.price);
                console.log('Product category:', product.category);
                console.log('Product image:', product.image);
                
                // Update product image
                const imageElement = document.getElementById(`img${columnIndex}`);
                if (imageElement) {
                    imageElement.src = product.image || "https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/1665px-No-Image-Placeholder.svg.png";
                    imageElement.alt = product.title || product.name || `Product ${productId}`;
                }
                
                // Update product title
                const titleElement = document.getElementById(`title${columnIndex}`);
                if (titleElement) {
                    titleElement.textContent = product.title || product.name || "N/A";
                }
                
                // Update price information
                updateProductPrice(columnIndex, product);
                
                // Update price details breakdown
                updatePriceDetails(columnIndex, product);
                
                // Update description
                const descElement = document.getElementById(`desc${columnIndex}`);
                if (descElement) {
                    descElement.textContent = product.description || "N/A";
                }
                
                // Update brand
                const brandElement = document.getElementById(`brand${columnIndex}`);
                if (brandElement) {
                    brandElement.textContent = product.brand || "N/A";
                }
                
                // Update category
                const categoryElement = document.getElementById(`category${columnIndex}`);
                if (categoryElement) {
                    const category = product.category || "N/A";
                    categoryElement.textContent = category !== "N/A" ? category.charAt(0).toUpperCase() + category.slice(1) : "N/A";
                }
                
                // Update serving size
                const servingSizeElement = document.getElementById(`servingSize${columnIndex}`);
                if (servingSizeElement) {
                    servingSizeElement.textContent = product.servingSize || "N/A";
                }
                
                // Update servings per container
                const servingsPerContainerElement = document.getElementById(`servingsPerContainer${columnIndex}`);
                if (servingsPerContainerElement) {
                    servingsPerContainerElement.textContent = product.servingsPerContainer || "N/A";
                }
                
                // Update protein per serving
                const proteinPerServingElement = document.getElementById(`proteinPerServing${columnIndex}`);
                if (proteinPerServingElement) {
                    proteinPerServingElement.textContent = product.proteinPerServing || "N/A";
                }
                
                // Update calories per serving
                const caloriesPerServingElement = document.getElementById(`caloriesPerServing${columnIndex}`);
                if (caloriesPerServingElement) {
                    const calories = product.caloriesPerServing;
                    caloriesPerServingElement.textContent = calories ? `${calories} kcal` : "N/A";
                }
                
                // Update price per serving
                const pricePerServingElement = document.getElementById(`pricePerServing${columnIndex}`);
                if (pricePerServingElement) {
                    pricePerServingElement.textContent = product.pricePerServing || "N/A";
                }
                
                // Update caffeine per serving (for pre-workout products)
                const caffeinePerServingElement = document.getElementById(`caffeinePerServing${columnIndex}`);
                if (caffeinePerServingElement) {
                    const caffeine = product.caffeinePerServing;
                    caffeinePerServingElement.textContent = caffeine ? `${caffeine}` : "N/A";
                }
                
                // Update creatine per serving (for creatine products)
                const creatinePerServingElement = document.getElementById(`creatinePerServing${columnIndex}`);
                if (creatinePerServingElement) {
                    const creatine = product.creatinePerServing || product.creatineContent;
                    creatinePerServingElement.textContent = creatine ? `${creatine}` : "N/A";
                }
                
                // Update BCAA ratio (for BCAA products)
                const bcaaRatioElement = document.getElementById(`bcaaRatio${columnIndex}`);
                if (bcaaRatioElement) {
                    bcaaRatioElement.textContent = product.bcaaRatio || "N/A";
                }
                
                // Update extract ratio (for ayurvedic products)
                const extractRatioElement = document.getElementById(`extractRatio${columnIndex}`);
                if (extractRatioElement) {
                    extractRatioElement.textContent = product.extractRatio || "N/A";
                }
                
                // Update EPA content (for fish oil products)
                const epaContentElement = document.getElementById(`epaContent${columnIndex}`);
                if (epaContentElement) {
                    const epa = product.epaContent;
                    epaContentElement.textContent = epa ? `${epa}` : "N/A";
                }
                
                // Update DHA content (for fish oil products)
                const dhaContentElement = document.getElementById(`dhaContent${columnIndex}`);
                if (dhaContentElement) {
                    const dha = product.dhaContent;
                    dhaContentElement.textContent = dha ? `${dha}` : "N/A";
                }
                
                // Update vitamin D content (for vitamin D products)
                const vitaminDContentElement = document.getElementById(`vitaminDContent${columnIndex}`);
                if (vitaminDContentElement) {
                    const vitaminD = product.vitaminDContent;
                    vitaminDContentElement.textContent = vitaminD ? `${vitaminD}` : "N/A";
                }
                
                // Update magnesium content (for magnesium products)
                const magnesiumContentElement = document.getElementById(`magnesiumContent${columnIndex}`);
                if (magnesiumContentElement) {
                    const magnesium = product.magnesiumContent;
                    magnesiumContentElement.textContent = magnesium ? `${magnesium}` : "N/A";
                }
                
                // Update zinc content (for zinc products)
                const zincContentElement = document.getElementById(`zincContent${columnIndex}`);
                if (zincContentElement) {
                    const zinc = product.zincContent;
                    zincContentElement.textContent = zinc ? `${zinc}` : "N/A";
                }
                
                // Update collagen content (for collagen products)
                const collagenContentElement = document.getElementById(`collagenContent${columnIndex}`);
                if (collagenContentElement) {
                    const collagen = product.collagenContent;
                    collagenContentElement.textContent = collagen ? `${collagen}` : "N/A";
                }
                
                // Update probiotic strains (for probiotic products)
                const probioticStrainsElement = document.getElementById(`probioticStrains${columnIndex}`);
                if (probioticStrainsElement) {
                    probioticStrainsElement.textContent = product.probioticStrains || "N/A";
                }
                
                // Update EGCG content (for green tea products)
                const egcgContentElement = document.getElementById(`egcgContent${columnIndex}`);
                if (egcgContentElement) {
                    const egcg = product.egcgContent;
                    egcgContentElement.textContent = egcg ? `${egcg}` : "N/A";
                }
                
                // Update glutamine content (for glutamine products)
                const glutamineContentElement = document.getElementById(`glutamineContent${columnIndex}`);
                if (glutamineContentElement) {
                    const glutamine = product.glutamineContent;
                    glutamineContentElement.textContent = glutamine ? `${glutamine}` : "N/A";
                }
                
                // Update vitamin count (for multivitamin products)
                const vitaminCountElement = document.getElementById(`vitaminCount${columnIndex}`);
                if (vitaminCountElement) {
                    vitaminCountElement.textContent = product.vitaminCount || "N/A";
                }
                
                // Update B vitamin content (for B-complex products)
                const bVitaminContentElement = document.getElementById(`bVitaminContent${columnIndex}`);
                if (bVitaminContentElement) {
                    bVitaminContentElement.textContent = product.bVitaminContent || "N/A";
                }
                
                // Update withania somnifera (for ashwagandha products)
                const withaniaSomniferaElement = document.getElementById(`withaniaSomnifera${columnIndex}`);
                if (withaniaSomniferaElement) {
                    const withania = product.withaniaSomnifera;
                    withaniaSomniferaElement.textContent = withania ? `${withania}` : "N/A";
                }
                
                // Update key features
                const keyFeaturesElement = document.getElementById(`keyFeatures${columnIndex}`);
                if (keyFeaturesElement && product.keyFeatures && product.keyFeatures.length > 0) {
                    keyFeaturesElement.innerHTML = product.keyFeatures.map(feature => 
                        `<span class="badge bg-primary me-1 mb-1">${feature}</span>`
                    ).join('');
                } else if (keyFeaturesElement) {
                    keyFeaturesElement.textContent = "N/A";
                }
                
                // Update available flavors
                const flavorsElement = document.getElementById(`flavors${columnIndex}`);
                if (flavorsElement && product.flavors && product.flavors.length > 0) {
                    flavorsElement.innerHTML = product.flavors.map(flavor => 
                        `<span class="badge bg-info me-1 mb-1">${flavor}</span>`
                    ).join('');
                } else if (flavorsElement) {
                    flavorsElement.textContent = "N/A";
                }
                
                // Update review count
                const reviewCountElement = document.getElementById(`reviewCount${columnIndex}`);
                if (reviewCountElement) {
                    const reviewCount = product.reviewCount || 0;
                    reviewCountElement.textContent = reviewCount > 0 ? reviewCount.toLocaleString() : "0";
                }
                
                // Update rating
                const ratingElement = document.getElementById(`rating${columnIndex}`);
                if (ratingElement) {
                    ratingElement.innerHTML = generateStarRating(product.rating || 4.0);
                }
                
                // Update stock status
                const stockElement = document.getElementById(`stock${columnIndex}`);
                if (stockElement) {
                    stockElement.textContent = product.stock || "N/A";
                }
                
                // Update shipping info
                const shippingElement = document.getElementById(`shipping${columnIndex}`);
                if (shippingElement) {
                    shippingElement.textContent = product.shipping || "N/A";
                }
                
                // Enable cart and wishlist buttons
                const cartBtn = document.getElementById(`cartBtn${columnIndex}`);
                const wishlistBtn = document.getElementById(`wishlistBtn${columnIndex}`);
                
                if (cartBtn) {
                    cartBtn.disabled = false;
                    cartBtn.innerHTML = '<i class="fas fa-shopping-cart me-1"></i>Add to Cart';
                    cartBtn.classList.remove('btn-secondary');
                    cartBtn.classList.add('btn-success');
                }
                
                if (wishlistBtn) {
                    wishlistBtn.disabled = false;
                    wishlistBtn.innerHTML = '<i class="fas fa-heart me-1"></i>Wishlist';
                    wishlistBtn.classList.remove('btn-secondary');
                    wishlistBtn.classList.add('btn-outline-primary');
                }
                
                console.log(`Product data updated successfully for column ${columnIndex}`);
            } else {
                console.log('Product not found, using fallback data');
                // Fallback to sample data if product not found
                const fallbackProducts = {
                    1: { 
                        name: "Green Jar Supplement", 
                        price: "2,499", 
                        originalPrice: "3,299",
                        discount: "24%",
                        brand: "Nature's Best", 
                        category: "Supplement",
                        description: "Premium blend for daily wellness and energy boost", 
                        image: "download.jpeg", 
                        rating: 4.8,
                        reviewCount: 1250,
                        servingSize: "30g",
                        servingsPerContainer: 30,
                        proteinPerServing: "25g",
                        caloriesPerServing: 120,
                        keyFeatures: ["Natural ingredients", "Energy boost", "Daily wellness", "No artificial colors"],
                        flavors: ["Berry Blast", "Citrus Fresh", "Tropical Mix"]
                    },
                    2: { 
                        name: "Protein Plus", 
                        price: "2,999", 
                        originalPrice: "3,599",
                        discount: "17%",
                        brand: "MuscleMax", 
                        category: "Protein",
                        description: "High-quality protein for muscle growth and recovery", 
                        image: "ChatGPT Image Jul 3, 2025, 11_12_00 AM.png", 
                        rating: 4.6,
                        reviewCount: 890,
                        servingSize: "35g",
                        servingsPerContainer: 28,
                        proteinPerServing: "30g",
                        caloriesPerServing: 150,
                        keyFeatures: ["High protein", "Fast absorption", "BCAAs included", "Low lactose"],
                        flavors: ["Chocolate", "Vanilla", "Strawberry"]
                    },
                    3: { 
                        name: "VitaBoost", 
                        price: "3,599", 
                        originalPrice: "4,199",
                        discount: "14%",
                        brand: "HealthFirst", 
                        category: "Vitamins",
                        description: "Essential vitamins and minerals for daily health", 
                        image: "ChatGPT Image Jul 4, 2025, 10_18_09 AM.png", 
                        rating: 4.9,
                        reviewCount: 1100,
                        servingSize: "1 tablet",
                        servingsPerContainer: 60,
                        proteinPerServing: "0g",
                        caloriesPerServing: 5,
                        keyFeatures: ["Complete vitamin complex", "Daily health support", "Immune boost", "Energy support"],
                        flavors: ["Unflavored"]
                    },
                    4: { 
                        name: "Omega-3 Fish Oil", 
                        price: "2,099", 
                        originalPrice: "2,599",
                        discount: "19%",
                        brand: "PureHealth", 
                        category: "Omega-3",
                        description: "Pure fish oil for heart and brain health", 
                        image: "download.jpeg", 
                        rating: 4.7,
                        reviewCount: 750,
                        servingSize: "2 capsules",
                        servingsPerContainer: 45,
                        proteinPerServing: "0g",
                        caloriesPerServing: 20,
                        keyFeatures: ["Heart health", "Brain function", "Anti-inflammatory", "Pure fish oil"],
                        flavors: ["Unflavored"]
                    },
                    5: { 
                        name: "Collagen Peptides", 
                        price: "3,299", 
                        originalPrice: "3,899",
                        discount: "15%",
                        brand: "BeautySupp", 
                        category: "Collagen",
                        description: "Collagen for skin, hair, and joint health", 
                        image: "ChatGPT Image Jul 3, 2025, 11_12_00 AM.png", 
                        rating: 4.5,
                        reviewCount: 680,
                        servingSize: "10g",
                        servingsPerContainer: 30,
                        proteinPerServing: "9g",
                        caloriesPerServing: 40,
                        keyFeatures: ["Skin health", "Hair growth", "Joint support", "Anti-aging"],
                        flavors: ["Unflavored", "Vanilla"]
                    },
                    6: { 
                        name: "Probiotic Blend", 
                        price: "2,699", 
                        originalPrice: "3,199",
                        discount: "16%",
                        brand: "GutHealth", 
                        category: "Probiotics",
                        description: "Advanced probiotic for digestive health", 
                        image: "ChatGPT Image Jul 4, 2025, 10_18_09 AM.png", 
                        rating: 4.4,
                        reviewCount: 520,
                        servingSize: "1 capsule",
                        servingsPerContainer: 30,
                        proteinPerServing: "0g",
                        caloriesPerServing: 5,
                        keyFeatures: ["Digestive health", "Gut flora", "Immune support", "Digestion aid"],
                        flavors: ["Unflavored"]
                    },
                    7: { 
                        name: "Vitamin D3", 
                        price: "1,599", 
                        originalPrice: "1,899",
                        discount: "16%",
                        brand: "SunVit", 
                        category: "Vitamins",
                        description: "High-potency vitamin D for immune support", 
                        image: "download.jpeg", 
                        rating: 4.3,
                        reviewCount: 420,
                        servingSize: "1 tablet",
                        servingsPerContainer: 90,
                        proteinPerServing: "0g",
                        caloriesPerServing: 5,
                        keyFeatures: ["Immune support", "Bone health", "High potency", "Daily essential"],
                        flavors: ["Unflavored"]
                    },
                    8: { 
                        name: "Magnesium Complex", 
                        price: "2,299", 
                        originalPrice: "2,699",
                        discount: "15%",
                        brand: "MineralMax", 
                        category: "Minerals",
                        description: "Magnesium blend for muscle and nerve function", 
                        image: "ChatGPT Image Jul 3, 2025, 11_12_00 AM.png", 
                        rating: 4.2,
                        reviewCount: 380,
                        servingSize: "2 tablets",
                        servingsPerContainer: 45,
                        proteinPerServing: "0g",
                        caloriesPerServing: 10,
                        keyFeatures: ["Muscle function", "Nerve health", "Sleep support", "Stress relief"],
                        flavors: ["Unflavored"]
                    },
                    9: { 
                        name: "B-Complex Vitamins", 
                        price: "1,899", 
                        originalPrice: "2,199",
                        discount: "14%",
                        brand: "VitaLife", 
                        category: "Vitamins",
                        description: "Complete B-vitamin complex for energy and metabolism", 
                        image: "ChatGPT Image Jul 4, 2025, 10_18_09 AM.png", 
                        rating: 4.1,
                        reviewCount: 320,
                        servingSize: "1 tablet",
                        servingsPerContainer: 60,
                        proteinPerServing: "0g",
                        caloriesPerServing: 5,
                        keyFeatures: ["Energy support", "Metabolism", "Nerve function", "Complete B-complex"],
                        flavors: ["Unflavored"]
                    },
                    10: { 
                        name: "Zinc Supplement", 
                        price: "1,299", 
                        originalPrice: "1,599",
                        discount: "19%",
                        brand: "MineralMax", 
                        category: "Minerals",
                        description: "Essential zinc for immune support and wound healing", 
                        image: "download.jpeg", 
                        rating: 4.0,
                        reviewCount: 280,
                        servingSize: "1 tablet",
                        servingsPerContainer: 60,
                        proteinPerServing: "0g",
                        caloriesPerServing: 5,
                        keyFeatures: ["Immune support", "Wound healing", "Skin health", "Antioxidant"],
                        flavors: ["Unflavored"]
                    },
                    11: { 
                        name: "Creatine Monohydrate", 
                        price: "1,799", 
                        originalPrice: "2,199",
                        discount: "18%",
                        brand: "PowerFuel", 
                        category: "Creatine",
                        description: "Pure creatine for muscle strength and power", 
                        image: "ChatGPT Image Jul 3, 2025, 11_12_00 AM.png", 
                        rating: 4.7,
                        reviewCount: 890,
                        servingSize: "5g",
                        servingsPerContainer: 60,
                        proteinPerServing: "0g",
                        caloriesPerServing: 20,
                        keyFeatures: ["Muscle strength", "Power output", "Pure creatine", "Performance"],
                        flavors: ["Unflavored"]
                    },
                    12: { 
                        name: "Ashwagandha Root", 
                        price: "2,199", 
                        originalPrice: "2,599",
                        discount: "15%",
                        brand: "AyurVeda", 
                        category: "Ayurveda",
                        description: "Ancient herb for stress relief and energy", 
                        image: "ChatGPT Image Jul 4, 2025, 10_18_09 AM.png", 
                        rating: 4.6,
                        reviewCount: 650,
                        servingSize: "600mg",
                        servingsPerContainer: 60,
                        proteinPerServing: "0g",
                        caloriesPerServing: 5,
                        keyFeatures: ["Stress relief", "Energy support", "Natural adaptogen", "Ancient wisdom"],
                        flavors: ["Unflavored"]
                    }
                };
                
                const fallbackProduct = fallbackProducts[productId];
                if (fallbackProduct) {
                    console.log('Using fallback product:', fallbackProduct.name);
                    
                    document.getElementById(`img${columnIndex}`).src = fallbackProduct.image;
                    updateProductPrice(columnIndex, fallbackProduct);
                    updatePriceDetails(columnIndex, fallbackProduct);
                    document.getElementById(`desc${columnIndex}`).textContent = fallbackProduct.description;
                    document.getElementById(`brand${columnIndex}`).textContent = fallbackProduct.brand;
                    document.getElementById(`category${columnIndex}`).textContent = fallbackProduct.category;
                    document.getElementById(`servingSize${columnIndex}`).textContent = fallbackProduct.servingSize;
                    document.getElementById(`servingsPerContainer${columnIndex}`).textContent = fallbackProduct.servingsPerContainer;
                    document.getElementById(`proteinPerServing${columnIndex}`).textContent = fallbackProduct.proteinPerServing;
                    document.getElementById(`caloriesPerServing${columnIndex}`).textContent = fallbackProduct.caloriesPerServing ? `${fallbackProduct.caloriesPerServing} kcal` : "N/A";
                    document.getElementById(`reviewCount${columnIndex}`).textContent = fallbackProduct.reviewCount ? fallbackProduct.reviewCount.toLocaleString() : "0";
                    document.getElementById(`rating${columnIndex}`).innerHTML = generateStarRating(fallbackProduct.rating);
                    
                    // Handle key features and flavors
                    if (fallbackProduct.keyFeatures && fallbackProduct.keyFeatures.length > 0) {
                        document.getElementById(`keyFeatures${columnIndex}`).innerHTML = fallbackProduct.keyFeatures.map(feature => 
                            `<span class="badge bg-primary me-1 mb-1">${feature}</span>`
                        ).join('');
                    } else {
                        document.getElementById(`keyFeatures${columnIndex}`).textContent = "N/A";
                    }
                    
                    if (fallbackProduct.flavors && fallbackProduct.flavors.length > 0) {
                        document.getElementById(`flavors${columnIndex}`).innerHTML = fallbackProduct.flavors.map(flavor => 
                            `<span class="badge bg-info me-1 mb-1">${flavor}</span>`
                        ).join('');
                    } else {
                        document.getElementById(`flavors${columnIndex}`).textContent = "N/A";
                    }
                    
                    // Enable buttons
                    const cartBtn = document.getElementById(`cartBtn${columnIndex}`);
                    const wishlistBtn = document.getElementById(`wishlistBtn${columnIndex}`);
                    
                    if (cartBtn) {
                        cartBtn.disabled = false;
                        cartBtn.innerHTML = '<i class="fas fa-shopping-cart me-1"></i>Add to Cart';
                        cartBtn.classList.remove('btn-secondary');
                        cartBtn.classList.add('btn-success');
                    }
                    
                    if (wishlistBtn) {
                        wishlistBtn.disabled = false;
                        wishlistBtn.innerHTML = '<i class="fas fa-heart me-1"></i>Wishlist';
                        wishlistBtn.classList.remove('btn-secondary');
                        wishlistBtn.classList.add('btn-outline-primary');
                    }
                }
            }
        }
        
        // Reset product price display
        function resetProductPrice(columnIndex) {
            const currentPriceElement = document.querySelector(`#price${columnIndex} .current-price`);
            const originalPriceElement = document.getElementById(`originalPrice${columnIndex}`);
            const discountElement = document.getElementById(`discount${columnIndex}`);
            const savingsElement = document.getElementById(`savings${columnIndex}`);
            const pricePerServingElement = document.getElementById(`pricePerServing${columnIndex}`);
            
            if (currentPriceElement) {
                currentPriceElement.textContent = "N/A";
            }
            if (originalPriceElement) {
                originalPriceElement.style.display = 'none';
            }
            if (discountElement) {
                discountElement.style.display = 'none';
            }
            if (savingsElement) {
                savingsElement.style.display = 'none';
            }
            if (pricePerServingElement) {
                pricePerServingElement.style.display = 'none';
            }
        }
        
        // Update product price with enhanced display
        function updateProductPrice(columnIndex, product) {
            const currentPriceElement = document.querySelector(`#price${columnIndex} .current-price`);
            const originalPriceElement = document.getElementById(`originalPrice${columnIndex}`);
            const discountElement = document.getElementById(`discount${columnIndex}`);
            const savingsElement = document.getElementById(`savings${columnIndex}`);
            const pricePerServingElement = document.getElementById(`pricePerServing${columnIndex}`);
            
            if (currentPriceElement) {
                currentPriceElement.textContent = product.price || "0";
            }
            
            // Show original price and discount if available
            if (product.originalPrice && product.originalPrice !== product.price) {
                if (originalPriceElement) {
                    originalPriceElement.textContent = product.originalPrice;
                    originalPriceElement.style.display = 'block';
                }
                
                if (discountElement && product.discount) {
                    discountElement.textContent = product.discount;
                    discountElement.style.display = 'inline-block';
                }
                
                // Calculate and show savings
                if (savingsElement) {
                    const currentPrice = parseFloat(product.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                    const originalPrice = parseFloat(product.originalPrice?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                    const savings = originalPrice - currentPrice;
                    
                    if (savings > 0) {
                        savingsElement.textContent = `Save ${savings.toFixed(0)}`;
                        savingsElement.style.display = 'block';
                    }
                }
            } else {
                // Hide discount elements if no original price
                if (originalPriceElement) originalPriceElement.style.display = 'none';
                if (discountElement) discountElement.style.display = 'none';
                if (savingsElement) savingsElement.style.display = 'none';
            }
            
            // Calculate and show price per serving automatically
            if (pricePerServingElement) {
                const currentPrice = parseFloat(product.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                const servingsPerContainer = parseInt(product.servingsPerContainer) || 0;
                
                if (currentPrice > 0 && servingsPerContainer > 0) {
                    const pricePerServing = currentPrice / servingsPerContainer;
                    pricePerServingElement.textContent = `${pricePerServing.toFixed(2)} per serving`;
                    pricePerServingElement.style.display = 'block';
                } else if (product.pricePerServing) {
                    // Use provided price per serving if available
                    pricePerServingElement.textContent = `${product.pricePerServing} per serving`;
                    pricePerServingElement.style.display = 'block';
                } else {
                    pricePerServingElement.style.display = 'none';
                }
            }
        }
        
        // Update price details breakdown
        function updatePriceDetails(columnIndex, product) {
            const priceBreakdownElement = document.getElementById(`priceBreakdown${columnIndex}`);
            if (!priceBreakdownElement) return;
            
            const currentPrice = parseFloat(product.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
            const originalPrice = parseFloat(product.originalPrice?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
            const servingsPerContainer = parseInt(product.servingsPerContainer) || 0;
            
            let breakdownHTML = '';
            
            if (currentPrice > 0) {
                breakdownHTML += `<div class="mb-1"><strong>Current Price:</strong> ${product.price}</div>`;
                
                if (originalPrice > 0 && originalPrice !== currentPrice) {
                    const savings = originalPrice - currentPrice;
                    const discountPercent = ((savings / originalPrice) * 100).toFixed(1);
                    breakdownHTML += `
                        <div class="mb-1"><strong>Original Price:</strong> ${product.originalPrice}</div>
                        <div class="mb-1 text-success"><strong>You Save:</strong> ${savings.toFixed(0)} (${discountPercent}%)</div>
                    `;
                }
                
                if (servingsPerContainer > 0) {
                    const pricePerServing = currentPrice / servingsPerContainer;
                    breakdownHTML += `<div class="mb-1"><strong>Price per serving:</strong> ${pricePerServing.toFixed(2)}</div>`;
                    
                    // Calculate monthly cost (assuming 1 serving per day)
                    const monthlyCost = pricePerServing * 30;
                    breakdownHTML += `<div class="mb-1"><strong>Monthly cost (1 serving/day):</strong> ${monthlyCost.toFixed(0)}</div>`;
                }
                
                // Add value rating
                if (product.rating && product.rating > 0) {
                    const valueRating = (product.rating / 5) * 100;
                    breakdownHTML += `<div class="mb-1"><strong>Value Rating:</strong> ${valueRating.toFixed(0)}%</div>`;
                }
            } else {
                breakdownHTML = '<div class="text-muted">Price information not available</div>';
            }
            
            priceBreakdownElement.innerHTML = breakdownHTML;
        }
        
        // Step navigation functions
        function goToNextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateStepIndicator();
                updateNavigationButtons();
                updateProgressBar();
            }
        }
        
        function goToPreviousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepIndicator();
                updateNavigationButtons();
                updateProgressBar();
            }
        }
        
        function updateStepIndicator() {
            // Remove all active and completed classes
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            // Add appropriate classes based on current step
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`step${i}`);
                if (i < currentStep) {
                    stepElement.classList.add('completed');
                } else if (i === currentStep) {
                    stepElement.classList.add('active');
                }
            }
        }
        
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            // Update Previous button
            prevBtn.disabled = currentStep === 1;
            
            // Update Next button
            if (currentStep === totalSteps) {
                nextBtn.innerHTML = 'Finish<i class="fas fa-check ms-2"></i>';
                nextBtn.onclick = finishComparison;
            } else {
                nextBtn.innerHTML = 'Next<i class="fas fa-arrow-right ms-2"></i>';
                nextBtn.onclick = goToNextStep;
            }
        }
        
        function updateProgressBar() {
            const progressBar = document.getElementById('progressBar');
            const progress = (currentStep / totalSteps) * 100;
            progressBar.style.width = progress + '%';
            progressBar.setAttribute('aria-valuenow', progress);
        }
        
        function finishComparison() {
            // Show completion message
            alert('Comparison completed! You can now make an informed decision based on the analysis.');
            // Optionally redirect to results page or show summary
        }
        
        // Cart functionality
        let cart = [];
        
        function addToCart(columnIndex) {
            const selectElement = document.getElementById(`select${columnIndex}`);
            const selectedValue = selectElement.value;
            
            if (selectedValue && selectedValue !== "0") {
                // Get product from data.js or use fallback
                const products = window.product || [];
                const product = products.find(p => p.id === parseInt(selectedValue));
                
                if (product) {
                    const cartItem = {
                        id: product.id,
                        title: product.title || product.name,
                        price: product.price,
                        brand: product.brand,
                        image: product.image,
                        quantity: 1
                    };
                    
                    // Get existing cart from localStorage
                    let existingCart = JSON.parse(localStorage.getItem('cart') || '[]');
                    
                    // Check if product already in cart
                    const existingIndex = existingCart.findIndex(item => item.id === product.id);
                    if (existingIndex !== -1) {
                        existingCart[existingIndex].quantity += 1;
                        showCartNotification(`Quantity updated for ${cartItem.title}`);
                    } else {
                        existingCart.push(cartItem);
                        showCartNotification(`${cartItem.title} added to cart!`);
                    }
                    
                    // Store updated cart
                    localStorage.setItem('cart', JSON.stringify(existingCart));
                    
                    // Update cart button
                    const cartBtn = document.getElementById(`cartBtn${columnIndex}`);
                    cartBtn.innerHTML = '<i class="fas fa-check me-1"></i>Added to Cart';
                    cartBtn.classList.remove('btn-success');
                    cartBtn.classList.add('btn-secondary');
                    cartBtn.disabled = true;
                    
                    // Update cart count display
                    updateCartCount();
                    
                    // Animate the count update
                    animateCountUpdate('cartSummaryCount', cartCount);
                    
                    // Show success notification
                    showCartNotification(`${cartItem.title} added to cart!`);
                    
                    console.log('Cart updated:', existingCart);
                }
            }
        }
        
        function addToWishlist(columnIndex) {
            const selectElement = document.getElementById(`select${columnIndex}`);
            const selectedValue = selectElement.value;
            
            if (selectedValue && selectedValue !== "0") {
                // Get product from data.js or use fallback
                const products = window.product || [];
                const product = products.find(p => p.id === parseInt(selectedValue));
                
                if (product) {
                    const wishlistItem = {
                        id: product.id,
                        title: product.title || product.name,
                        price: product.price,
                        brand: product.brand,
                        image: product.image,
                        rating: product.rating,
                        reviewCount: product.reviewCount
                    };
                    
                    // Get existing wishlist from localStorage
                    let existingWishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
                    
                    // Check if product already in wishlist
                    const existingIndex = existingWishlist.findIndex(item => item.id === product.id);
                    if (existingIndex !== -1) {
                        showCartNotification(`${wishlistItem.title} is already in your wishlist!`);
                    } else {
                        existingWishlist.push(wishlistItem);
                        showCartNotification(`${wishlistItem.title} added to wishlist!`);
                        
                        // Update wishlist button
                        const wishlistBtn = document.getElementById(`wishlistBtn${columnIndex}`);
                        wishlistBtn.innerHTML = '<i class="fas fa-check me-1"></i>Added to Wishlist';
                        wishlistBtn.classList.remove('btn-outline-primary');
                        wishlistBtn.classList.add('btn-secondary');
                        wishlistBtn.disabled = true;
                    }
                    
                    // Store updated wishlist
                    localStorage.setItem('wishlist', JSON.stringify(existingWishlist));
                    
                    // Update wishlist count display
                    updateWishlistCount();
                    
                    // Animate the count update
                    animateCountUpdate('wishlistSummaryCount', wishlistCount);
                    
                    console.log('Wishlist updated:', existingWishlist);
                }
            }
        }
        
        function showCartNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'alert alert-success alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-shopping-cart me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        function updateCartCount() {
            const existingCart = JSON.parse(localStorage.getItem('cart') || '[]');
            const cartCount = existingCart.reduce((total, item) => total + (item.quantity || 1), 0);
            const totalValue = existingCart.reduce((total, item) => {
                const price = parseFloat(item.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                return total + (price * (item.quantity || 1));
            }, 0);
            
            // Update summary card
            const cartSummaryCount = document.getElementById('cartSummaryCount');
            const cartSummaryDetails = document.getElementById('cartSummaryDetails');
            const cartBadge = document.getElementById('cartBadge');
            
            if (cartSummaryCount) {
                cartSummaryCount.textContent = cartCount;
            }
            
            if (cartSummaryDetails) {
                if (cartCount === 0) {
                    cartSummaryDetails.textContent = 'No items added yet';
                } else if (cartCount === 1) {
                    cartSummaryDetails.textContent = `${existingCart.length} unique product`;
                } else {
                    cartSummaryDetails.textContent = `${existingCart.length} unique products  ${totalValue.toFixed(0)} total`;
                }
            }
            
            // Show/hide animated badge
            if (cartBadge) {
                if (cartCount > 0) {
                    cartBadge.style.display = 'flex';
                    cartBadge.textContent = cartCount;
                } else {
                    cartBadge.style.display = 'none';
                }
            }
        }
        
        function updateWishlistCount() {
            const existingWishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const wishlistCount = existingWishlist.length;
            const totalValue = existingWishlist.reduce((total, item) => {
                const price = parseFloat(item.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                return total + price;
            }, 0);
            
            // Update summary card
            const wishlistSummaryCount = document.getElementById('wishlistSummaryCount');
            const wishlistSummaryDetails = document.getElementById('wishlistSummaryDetails');
            const wishlistBadge = document.getElementById('wishlistBadge');
            
            if (wishlistSummaryCount) {
                wishlistSummaryCount.textContent = wishlistCount;
            }
            
            if (wishlistSummaryDetails) {
                if (wishlistCount === 0) {
                    wishlistSummaryDetails.textContent = 'No items saved yet';
                } else if (wishlistCount === 1) {
                    wishlistSummaryDetails.textContent = '1 saved product';
                } else {
                    wishlistSummaryDetails.textContent = `${wishlistCount} saved products  ${totalValue.toFixed(0)} total value`;
                }
            }
            
            // Show/hide animated badge
            if (wishlistBadge) {
                if (wishlistCount > 0) {
                    wishlistBadge.style.display = 'flex';
                    wishlistBadge.textContent = wishlistCount;
                } else {
                    wishlistBadge.style.display = 'none';
                }
            }
        }
        
        function viewWishlist() {
            const existingWishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            
            if (existingWishlist.length === 0) {
                alert('Your wishlist is empty!');
                return;
            }
            
            // Redirect to wishlist page
            window.location.href = 'wishlist.html';
        }
        
        function viewCart() {
            const existingCart = JSON.parse(localStorage.getItem('cart') || '[]');
            
            if (existingCart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            // Redirect to cart page
            window.location.href = 'cart.html';
        }
        
        // Load cart from localStorage on page load
        function loadCart() {
            const savedCart = localStorage.getItem('suppCompareCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                console.log('Cart loaded:', cart);
            }
        }
        

        
        // Handle search results and category selections
        function handleSearchResults() {
            const urlParams = new URLSearchParams(window.location.search);
            const searchTerm = urlParams.get('search');
            const category = urlParams.get('category');
            
            if (searchTerm) {
                // Get search results from localStorage
                const searchResults = JSON.parse(localStorage.getItem('searchResults') || '[]');
                
                if (searchResults.length > 0) {
                    // Auto-populate first few search results
                    searchResults.slice(0, Math.min(searchResults.length, productCount)).forEach((product, index) => {
                        const columnIndex = index + 1;
                        if (columnIndex <= productCount) {
                            // Find the product in our data and select it
                            const productId = findProductIdByName(product.title);
                            if (productId) {
                                document.getElementById(`select${columnIndex}`).value = productId;
                                updateProduct(columnIndex, productId);
                            }
                        }
                    });
                }
            }
            
            if (category) {
                // Handle category-based product selection
                handleCategorySelection(category);
            }
        }
        
        // Handle category-based product selection
        function handleCategorySelection(category) {
            console.log('Handling category selection:', category);
            
            // First check if we have category products in localStorage
            const storedCategoryProducts = JSON.parse(localStorage.getItem('categoryProducts') || '[]');
            
            if (storedCategoryProducts.length > 0) {
                console.log('Using stored category products:', storedCategoryProducts.length);
                
                // Auto-populate with stored category products
                storedCategoryProducts.slice(0, Math.min(storedCategoryProducts.length, productCount)).forEach((product, index) => {
                    const columnIndex = index + 1;
                    if (columnIndex <= productCount) {
                        document.getElementById(`select${columnIndex}`).value = product.id;
                        updateProduct(columnIndex, product.id);
                    }
                });
                
                // Clear stored category products after use
                localStorage.removeItem('categoryProducts');
                return;
            }
            
            // Fallback: Get products from data.js
            const products = window.product || [];
            
            // Filter products by category
            const categoryProducts = products.filter(product => 
                product.category && product.category.toLowerCase() === category.toLowerCase()
            );
            
            console.log(`Found ${categoryProducts.length} products in category: ${category}`);
            
            if (categoryProducts.length > 0) {
                // Auto-populate first few category products
                categoryProducts.slice(0, Math.min(categoryProducts.length, productCount)).forEach((product, index) => {
                    const columnIndex = index + 1;
                    if (columnIndex <= productCount) {
                        document.getElementById(`select${columnIndex}`).value = product.id;
                        updateProduct(columnIndex, product.id);
                    }
                });
            } else {
                showSearchNotification(`No products found in category: ${category}`, 'warning');
            }
        }

        function showSearchNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; left: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-search me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        function findProductIdByName(productName) {
            // Search in the sample product data
            const products = {
                1: { name: "Green Jar Supplement" },
                2: { name: "Protein Plus" },
                3: { name: "VitaBoost" },
                4: { name: "Omega-3 Fish Oil" },
                5: { name: "Collagen Peptides" },
                6: { name: "Probiotic Blend" },
                7: { name: "Vitamin D3" },
                8: { name: "Magnesium Complex" },
                9: { name: "B-Complex Vitamins" },
                10: { name: "Zinc Supplement" },
                11: { name: "Creatine Monohydrate" },
                12: { name: "Ashwagandha Root" }
            };
            
            for (let id in products) {
                if (products[id].name.toLowerCase() === productName.toLowerCase()) {
                    return parseInt(id);
                }
            }
            return null;
        }


        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded - Initializing comparison page');
            
            // Wait for data.js to load and then initialize
            function initializeComparison() {
                // Check if data.js is loaded
                if (window.product && Array.isArray(window.product) && window.product.length > 0) {
                    console.log(' Product data loaded successfully:', window.product.length, 'products');
                    console.log('Sample product:', window.product[0]);
                } else {
                    console.warn(' Product data not found or empty, using fallback data');
                    // Create fallback product data if not available
                    if (!window.product) {
                        window.product = [
                            { id: 1, title: "Whey Protein Isolate", price: "3,499", brand: "MuscleMax Pro", category: "protein", description: "Premium whey protein isolate with 90% protein content", image: "src/IMG-20250706-WA0021.jpg", rating: 4.8, reviewCount: 1247, servingSize: "30g", servingsPerContainer: 30, proteinPerServing: "27g", caloriesPerServing: 120, keyFeatures: ["90% protein content", "Low lactose", "Fast absorption"], flavors: ["Chocolate", "Vanilla", "Strawberry"] },
                            { id: 2, title: "Mass Gainer Pro", price: "2,999", brand: "BulkSupplements", category: "gainers", description: "High-calorie mass gainer with complex carbs and quality protein", image: "src/IMG-20250706-WA0020.jpg", rating: 4.6, reviewCount: 892, servingSize: "150g", servingsPerContainer: 20, proteinPerServing: "50g", caloriesPerServing: 650, keyFeatures: ["50g protein per serving", "650 calories", "Complex carbohydrates"], flavors: ["Chocolate", "Vanilla", "Banana"] },
                            { id: 3, title: "Pre-Workout Explosion", price: "1,899", brand: "PowerFuel", category: "pre-workout", description: "Advanced pre-workout formula with caffeine, creatine, and beta-alanine", image: "src/IMG-20250706-WA0019.jpg", rating: 4.7, reviewCount: 1103, servingSize: "15g", servingsPerContainer: 30, proteinPerServing: "0g", caloriesPerServing: 50, keyFeatures: ["300mg caffeine", "5g creatine", "Beta-alanine"], flavors: ["Fruit Punch", "Blue Raspberry", "Watermelon"] },
                            { id: 4, title: "BCAA Recovery", price: "1,599", brand: "RecoveryPlus", category: "post-workout", description: "Essential amino acids for muscle recovery and growth", image: "src/IMG-20250706-WA0018.jpg", rating: 4.5, reviewCount: 756, servingSize: "10g", servingsPerContainer: 30, proteinPerServing: "0g", caloriesPerServing: 40, keyFeatures: ["2:1:1 BCAA ratio", "Zero calories", "Instant recovery"], flavors: ["Lemon Lime", "Orange Mango", "Cherry"] }
                        ];
                        console.log(' Fallback product data created:', window.product.length, 'products');
                    }
                }
                
                // Update cart and wishlist counts
                updateCartCount();
                updateWishlistCount();
                
                // Set initial button state
                updateAddButtonState();
                
                // Initialize search inputs
                console.log('Initializing search inputs...');
                // Add keyboard event listeners to search inputs
                for (let i = 1; i <= productCount; i++) {
                    const searchInput = document.getElementById(`searchInput${i}`);
                    if (searchInput) {
                        searchInput.addEventListener('keydown', (event) => handleSearchKeydown(i, event));
                    }
                }
                
                // Initialize step indicator
                updateStepIndicator();
                updateNavigationButtons();
                updateProgressBar();
                
                        // Handle search results if any
        handleSearchResults();
        
        // Handle search results from URL parameters
        function handleSearchResults() {
            const urlParams = new URLSearchParams(window.location.search);
            const searchParam = urlParams.get('search');
            
            if (searchParam) {
                console.log('Found search parameter:', searchParam);
                // Perform search and show results
                performSearch(1, searchParam);
            }
        }
        
        // Update step indicator
        function updateStepIndicator() {
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) {
                    if (i <= currentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                }
            }
        }
        
        // Update navigation buttons
        function updateNavigationButtons() {
            // This function can be expanded for multi-step navigation
            console.log('Navigation buttons updated for step:', currentStep);
        }
        
        // Update progress bar
        function updateProgressBar() {
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                const progress = (currentStep / totalSteps) * 100;
                progressBar.style.width = `${progress}%`;
                progressBar.setAttribute('aria-valuenow', progress);
            }
        }
        
        // Update add button state
        function updateAddButtonState() {
            // This function can be used to control the add product button state
            console.log('Add button state updated. Current product count:', productCount);
        }
                
                        // Handle automatic product selection from compare button
        handleAutoProductSelection();
        
        // Auto-select products from various sources
        function handleAutoProductSelection() {
            console.log('Handling auto product selection...');
            
            // Check URL parameters first
            const urlParams = new URLSearchParams(window.location.search);
            const compareParam = urlParams.get('compare');
            const searchParam = urlParams.get('search');
            const categoryParam = urlParams.get('category');
            
            if (compareParam) {
                console.log('Found compare parameter:', compareParam);
                const productIds = compareParam.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
                autoSelectProducts(productIds);
                return;
            }
            
            // Check localStorage for compareProduct
            const compareProduct = JSON.parse(localStorage.getItem('compareProduct') || 'null');
            if (compareProduct && compareProduct.id) {
                console.log('Found compareProduct in localStorage:', compareProduct);
                autoSelectProducts([compareProduct.id]);
                localStorage.removeItem('compareProduct'); // Clear after use
                return;
            }
            
            // Check localStorage for compareList
            const compareList = JSON.parse(localStorage.getItem('compareList') || '[]');
            if (compareList.length > 0) {
                console.log('Found compareList in localStorage:', compareList);
                autoSelectProducts(compareList);
                localStorage.removeItem('compareList'); // Clear after use
                return;
            }
            
            // Check localStorage for searchResults
            const searchResults = JSON.parse(localStorage.getItem('searchResults') || '[]');
            if (searchResults.length > 0) {
                console.log('Found searchResults in localStorage:', searchResults);
                const productIds = searchResults.slice(0, 2).map(p => p.id);
                autoSelectProducts(productIds);
                localStorage.removeItem('searchResults'); // Clear after use
                return;
            }
            
            // Check localStorage for categoryProducts
            const categoryProducts = JSON.parse(localStorage.getItem('categoryProducts') || '[]');
            if (categoryProducts.length > 0) {
                console.log('Found categoryProducts in localStorage:', categoryProducts);
                const productIds = categoryProducts.slice(0, 2).map(p => p.id);
                autoSelectProducts(productIds);
                localStorage.removeItem('categoryProducts'); // Clear after use
                return;
            }
            
            console.log('No auto-selection data found');
        }
        
        // Auto-select products in columns
        function autoSelectProducts(productIds) {
            console.log('Auto-selecting products:', productIds);
            
            productIds.forEach((productId, index) => {
                const columnIndex = index + 1;
                if (columnIndex <= productCount) {
                    const product = window.product.find(p => p.id === productId);
                    if (product) {
                        console.log(`Auto-selecting product ${productId} in column ${columnIndex}:`, product.title);
                        
                        // Update search input
                        const searchInput = document.getElementById(`searchInput${columnIndex}`);
                        if (searchInput) {
                            searchInput.value = product.title;
                        }
                        
                        // Update product display
                        updateProduct(columnIndex, productId);
                        
                        // Show success message
                        setTimeout(() => {
                            showAlert(`Auto-selected: ${product.title}`, 'success');
                        }, 500);
                    }
                }
            });
        }
                
                // Initialize price and rating comparisons
                setTimeout(() => {
                    comparePrices();
                    compareRatings();
                }, 500);
                
                // Refresh counts every 5 seconds to stay in sync
                setInterval(() => {
                    updateCartCount();
                    updateWishlistCount();
                }, 5000);
                
                console.log(' Comparison page initialized successfully');
            }
            
            // Try to initialize immediately
            initializeComparison();
            
            // If data.js hasn't loaded yet, wait a bit and try again
            if (!window.product || window.product.length === 0) {
                console.log('Waiting for data.js to load...');
                setTimeout(initializeComparison, 1000);
            }
        });
        
        // Test function to verify data loading
        function testDataLoading() {
            console.log('=== Testing Data Loading ===');
            console.log('window.product:', window.product);
            console.log('Product count:', window.product ? window.product.length : 'Not loaded');
            
            if (window.product && window.product.length > 0) {
                console.log('First product details:', {
                    id: window.product[0].id,
                    title: window.product[0].title,
                    price: window.product[0].price,
                    brand: window.product[0].brand,
                    category: window.product[0].category,
                    servingSize: window.product[0].servingSize,
                    servingsPerContainer: window.product[0].servingsPerContainer,
                    proteinPerServing: window.product[0].proteinPerServing,
                    caloriesPerServing: window.product[0].caloriesPerServing,
                    keyFeatures: window.product[0].keyFeatures,
                    flavors: window.product[0].flavors,
                    reviewCount: window.product[0].reviewCount,
                    rating: window.product[0].rating
                });
            }
            
            // Test dropdown population
            const select1 = document.getElementById('select1');
            if (select1) {
                console.log('Select1 options count:', select1.children.length);
                console.log('Select1 options:', Array.from(select1.children).map(opt => opt.textContent));
            }
        }
        
        // Test function to verify product update
        function testProductUpdate(columnIndex = 1, productId = 1) {
            console.log(`=== Testing Product Update for Column ${columnIndex}, Product ID ${productId} ===`);
            
            // Simulate selecting a product
            const selectElement = document.getElementById(`select${columnIndex}`);
            if (selectElement) {
                selectElement.value = productId;
                updateProduct(columnIndex, productId);
                
                // Check if data was populated
                setTimeout(() => {
                    console.log('Image src:', document.getElementById(`img${columnIndex}`)?.src);
                    console.log('Description:', document.getElementById(`desc${columnIndex}`)?.textContent);
                    console.log('Brand:', document.getElementById(`brand${columnIndex}`)?.textContent);
                    console.log('Category:', document.getElementById(`category${columnIndex}`)?.textContent);
                    console.log('Serving Size:', document.getElementById(`servingSize${columnIndex}`)?.textContent);
                    console.log('Servings Per Container:', document.getElementById(`servingsPerContainer${columnIndex}`)?.textContent);
                    console.log('Protein Per Serving:', document.getElementById(`proteinPerServing${columnIndex}`)?.textContent);
                    console.log('Calories Per Serving:', document.getElementById(`caloriesPerServing${columnIndex}`)?.textContent);
                    console.log('Key Features:', document.getElementById(`keyFeatures${columnIndex}`)?.innerHTML);
                    console.log('Flavors:', document.getElementById(`flavors${columnIndex}`)?.innerHTML);
                    console.log('Review Count:', document.getElementById(`reviewCount${columnIndex}`)?.textContent);
                    console.log('Rating:', document.getElementById(`rating${columnIndex}`)?.innerHTML);
                }, 100);
            }
        }
        
        // Make test functions globally available
        window.testDataLoading = testDataLoading;
        window.testProductUpdate = testProductUpdate;
        
        // Test function for auto-selection functionality
        function testAutoSelection() {
            console.log('=== Testing Auto-Selection Functionality ===');
            
            // Test 1: Test with compareList
            console.log('1. Testing with compareList...');
            const testCompareList = [1, 2, 3];
            localStorage.setItem('compareList', JSON.stringify(testCompareList));
            console.log(' compareList set:', testCompareList);
            
            // Test 2: Test with compareProduct
            console.log('2. Testing with compareProduct...');
            const testProduct = { id: 4, title: 'Test Product', price: '999' };
            localStorage.setItem('compareProduct', JSON.stringify(testProduct));
            console.log(' compareProduct set:', testProduct);
            
            // Test 3: Test with searchResults
            console.log('3. Testing with searchResults...');
            const testSearchResults = [
                { id: 5, title: 'Search Product 1' },
                { id: 6, title: 'Search Product 2' }
            ];
            localStorage.setItem('searchResults', JSON.stringify(testSearchResults));
            console.log(' searchResults set:', testSearchResults);
            
            // Test 4: Test with categoryProducts
            console.log('4. Testing with categoryProducts...');
            const testCategoryProducts = [
                { id: 7, title: 'Category Product 1' },
                { id: 8, title: 'Category Product 2' },
                { id: 9, title: 'Category Product 3' }
            ];
            localStorage.setItem('categoryProducts', JSON.stringify(testCategoryProducts));
            console.log(' categoryProducts set:', testCategoryProducts);
            
            console.log('=== Auto-Selection Test Setup Complete ===');
            console.log(' Now refresh the page to test auto-selection');
            console.log(' Or run handleAutoProductSelection() to test immediately');
        }
        
        // Make test function globally available
        window.testAutoSelection = testAutoSelection;
        
        // Test function for search functionality
        function testSearchFunctionality() {
            console.log('=== Testing Search Functionality ===');
            
            // Test 1: Check if search inputs exist
            console.log('1. Checking search inputs...');
            for (let i = 1; i <= 2; i++) {
                const searchInput = document.getElementById(`searchInput${i}`);
                const searchResults = document.getElementById(`searchResults${i}`);
                const searchResultsList = document.getElementById(`searchResultsList${i}`);
                
                if (searchInput && searchResults && searchResultsList) {
                    console.log(` Search components for column ${i} found`);
                } else {
                    console.error(` Search components for column ${i} missing`);
                }
            }
            
            // Test 2: Test search functionality
            console.log('2. Testing search functionality...');
            if (window.product && window.product.length > 0) {
                const testProduct = window.product[0];
                console.log(`Testing search with: ${testProduct.title}`);
                
                // Simulate search
                handleSearchInput(1, testProduct.title.substring(0, 3));
                
                setTimeout(() => {
                    const resultsList = document.getElementById('searchResultsList1');
                    if (resultsList && resultsList.children.length > 0) {
                        console.log(' Search results displayed');
                    } else {
                        console.log(' No search results found');
                    }
                }, 500);
            }
            
            // Test 3: Test product selection
            console.log('3. Testing product selection...');
            if (window.product && window.product.length > 0) {
                const testProduct = window.product[0];
                selectProductFromSearch(1, testProduct.id);
                console.log(' Product selection test completed');
            }
        }
        
        // Make test function globally available
        window.testSearchFunctionality = testSearchFunctionality;
        
        // ===== AUTO PRODUCT SELECTION FROM COMPARE BUTTON =====
        
        // Handle automatic product selection when coming from compare button
        function handleAutoProductSelection() {
            console.log('Handling auto product selection...');
            
            // Check URL parameters first
            const urlParams = new URLSearchParams(window.location.search);
            const compareParam = urlParams.get('compare');
            const productParam = urlParams.get('product');
            const searchParam = urlParams.get('search');
            const categoryParam = urlParams.get('category');
            
            // Check localStorage for compare data
            const compareProduct = JSON.parse(localStorage.getItem('compareProduct') || 'null');
            const compareList = JSON.parse(localStorage.getItem('compareList') || '[]');
            const searchResults = JSON.parse(localStorage.getItem('searchResults') || '[]');
            const categoryProducts = JSON.parse(localStorage.getItem('categoryProducts') || '[]');
            
            let productsToSelect = [];
            
            // Priority 1: URL compare parameter (comma-separated product IDs)
            if (compareParam) {
                console.log('Found compare parameter:', compareParam);
                const productIds = compareParam.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
                productsToSelect = productIds.slice(0, 4); // Max 4 products
            }
            // Priority 2: URL product parameter (single product)
            else if (productParam) {
                console.log('Found product parameter:', productParam);
                const productId = parseInt(productParam);
                if (!isNaN(productId)) {
                    productsToSelect = [productId];
                }
            }
            // Priority 3: localStorage compareProduct (single product)
            else if (compareProduct && compareProduct.id) {
                console.log('Found compareProduct in localStorage:', compareProduct);
                productsToSelect = [compareProduct.id];
            }
            // Priority 4: localStorage compareList (multiple products)
            else if (compareList && compareList.length > 0) {
                console.log('Found compareList in localStorage:', compareList);
                productsToSelect = compareList.slice(0, 4); // Max 4 products
            }
            // Priority 5: Search results
            else if (searchParam && searchResults.length > 0) {
                console.log('Found search results:', searchResults);
                productsToSelect = searchResults.slice(0, 4).map(p => p.id);
            }
            // Priority 6: Category products
            else if (categoryProducts.length > 0) {
                console.log('Found category products:', categoryProducts);
                productsToSelect = categoryProducts.slice(0, 4).map(p => p.id);
            }
            // Priority 7: Category parameter (fallback)
            else if (categoryParam) {
                console.log('Found category parameter:', categoryParam);
                const categoryProducts = getProductsByCategory(categoryParam);
                productsToSelect = categoryProducts.slice(0, 4).map(p => p.id);
            }
            
            // Auto-select products if found
            if (productsToSelect.length > 0) {
                console.log('Auto-selecting products:', productsToSelect);
                autoSelectProducts(productsToSelect);
                
                // Clear the data after auto-selection to prevent re-selection on refresh
                setTimeout(() => {
                    localStorage.removeItem('compareProduct');
                    localStorage.removeItem('compareList');
                    localStorage.removeItem('searchResults');
                    localStorage.removeItem('categoryProducts');
                    
                    // Clear URL parameters without page reload
                    const newUrl = window.location.pathname;
                    window.history.replaceState({}, document.title, newUrl);
                }, 1000);
            } else {
                console.log('No products to auto-select');
            }
        }
        
        // Auto-select products in comparison columns
        function autoSelectProducts(productIds) {
            console.log('Auto-selecting products:', productIds);
            
            productIds.forEach((productId, index) => {
                const columnIndex = index + 1;
                
                // Check if product exists
                const product = window.product.find(p => p.id === productId);
                if (!product) {
                    console.warn(`Product with ID ${productId} not found`);
                    return;
                }
                
                console.log(`Selecting product ${productId} (${product.title}) in column ${columnIndex}`);
                
                // Update the search input with product name
                const searchInput = document.getElementById(`searchInput${columnIndex}`);
                if (searchInput) {
                    searchInput.value = product.title;
                    
                    // Update the product display
                    updateProduct(columnIndex, productId);
                    
                    // Show success message
                    showAlert(`Auto-selected: ${product.title}`, 'success');
                } else {
                    console.error(`Search input for column ${columnIndex} not found`);
                }
            });
            
            // Update comparisons after all products are selected
            setTimeout(() => {
                comparePrices();
                compareRatings();
                updateStepIndicator();
            }, 500);
        }
        
        // Show alert notification
        function showAlert(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        

        
        // Get selected products data
        function getSelectedProducts() {
            const selectedProducts = [];
            
            for (let i = 1; i <= productCount; i++) {
                const selectElement = document.getElementById(`select${i}`);
                const selectedValue = selectElement.value;
                
                if (selectedValue && selectedValue !== "0") {
                    const products = window.product || [];
                    const product = products.find(p => p.id === parseInt(selectedValue));
                    
                    if (product) {
                        selectedProducts.push({
                            ...product,
                            columnIndex: i
                        });
                    }
                }
            }
            
            return selectedProducts;
        }
        
        // Generate comparison summary HTML
        function generateComparisonSummary(products) {
            if (products.length === 0) return '';
            
            let summaryHTML = '<div class="row">';
            
            products.forEach(product => {
                const price = product.price || 'N/A';
                const rating = product.rating || 0;
                const brand = product.brand || 'Unknown Brand';
                
                summaryHTML += `
                    <div class="col-md-6 mb-3">
                        <div class="product-detail-card">
                            <div class="d-flex align-items-center mb-2">
                                <img src="${product.image || 'download.jpeg'}" alt="${product.title || product.name}" 
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px; margin-right: 10px;">
                                <div>
                                    <strong>${product.title || product.name}</strong>
                                    <div class="text-muted small">${brand}</div>
                                </div>
                            </div>
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="text-primary fw-bold">${price}</div>
                                    <small class="text-muted">Price</small>
                                </div>
                                <div class="col-4">
                                    <div class="text-warning fw-bold">${rating.toFixed(1)}</div>
                                    <small class="text-muted">Rating</small>
                                </div>
                                <div class="col-4">
                                    <div class="text-success fw-bold">Product ${product.columnIndex}</div>
                                    <small class="text-muted">Position</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            summaryHTML += '</div>';
            
            // Add comparison insights
            if (products.length > 1) {
                const prices = products.map(p => parseFloat(p.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0).filter(p => p > 0);
                const ratings = products.map(p => p.rating || 0).filter(r => r > 0);
                
                if (prices.length > 1) {
                    const minPrice = Math.min(...prices);
                    const maxPrice = Math.max(...prices);
                    const priceRange = maxPrice - minPrice;
                    const cheapestProduct = products.find(p => parseFloat(p.price?.replace(/[^0-9,]/g, '').replace(',', '')) === minPrice);
                    
                    summaryHTML += `
                        <div class="alert alert-info mt-3">
                            <h6><i class="fas fa-lightbulb me-2"></i>Comparison Insights</h6>
                            <ul class="mb-0">
                                <li><strong>Best Value:</strong> ${cheapestProduct?.title || cheapestProduct?.name} at ${cheapestProduct?.price}</li>
                                <li><strong>Price Range:</strong> ${priceRange.toFixed(0)} difference</li>
                                ${ratings.length > 1 ? `<li><strong>Highest Rated:</strong> ${Math.max(...ratings).toFixed(1)}/5.0 stars</li>` : ''}
                            </ul>
                        </div>
                    `;
                }
            }
            
            return summaryHTML;
        }
        


        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : 'info'}-circle me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        // Animate count update
        function animateCountUpdate(elementId, newCount) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.2)';
                element.style.transition = 'transform 0.3s ease';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 300);
            }
        }
        
        // Show cart/wishlist summary
        function showCartWishlistSummary() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            
            const cartTotal = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            const cartValue = cart.reduce((sum, item) => {
                const price = parseFloat(item.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                return sum + (price * (item.quantity || 1));
            }, 0);
            
            const wishlistValue = wishlist.reduce((sum, item) => {
                const price = parseFloat(item.price?.replace(/[^0-9,]/g, '').replace(',', '')) || 0;
                return sum + price;
            }, 0);
            
            console.log(`Cart: ${cartTotal} items (${cartValue.toFixed(0)}) | Wishlist: ${wishlist.length} items (${wishlistValue.toFixed(0)})`);
        }
        
        // Test functions for debugging
        function testAddProduct() {
            console.log('Testing addProductColumn function...');
            addProductColumn();
        }
        
        function testProductData() {
            console.log('Testing product data availability...');
            console.log('window.product:', window.product);
            console.log('Product count:', window.product ? window.product.length : 'Not loaded');
        }
        
        // Test function for add product functionality
        function testAddProductFunctionality() {
            console.log('=== Testing Add Product Functionality ===');
            console.log('Current product count:', productCount);
            console.log('Max products:', maxProducts);
            
            // Test adding products up to the limit
            for (let i = productCount; i < maxProducts; i++) {
                console.log(`Adding product ${i + 1}...`);
                addProductColumn();
                
                // Check if button state is correct
                const addBtn = document.getElementById('addProductBtn');
                console.log('Add button state:', {
                    disabled: addBtn.disabled,
                    text: addBtn.innerHTML,
                    productCount: productCount
                });
            }
            
            // Try to add one more (should fail)
            console.log('Trying to add one more product (should fail)...');
            addProductColumn();
            
            console.log('Final product count:', productCount);
        }
        
        // Make functions globally available for testing
        window.testAddProduct = testAddProduct;
        window.testProductData = testProductData;
        window.testAddProductFunctionality = testAddProductFunctionality;
        
        // Simple test to verify add product button
        function testAddProductButton() {
            console.log('Testing Add Product Button...');
            const addBtn = document.getElementById('addProductBtn');
            
            if (addBtn) {
                console.log('Add button found:', {
                    text: addBtn.innerHTML,
                    disabled: addBtn.disabled,
                    onclick: addBtn.onclick
                });
                
                // Test clicking the button
                if (!addBtn.disabled) {
                    console.log('Button is enabled, testing click...');
                    addProductColumn();
                } else {
                    console.log('Button is disabled');
                }
            } else {
                console.error('Add product button not found!');
            }
        }
        
        // Make the test function globally available
        window.testAddProductButton = testAddProductButton;
        
        // Test function for 2-product comparison
        function test2ProductComparison() {
            console.log('=== Testing 2-Product Comparison ===');
            console.log('Current product count:', productCount);
            console.log('Max products:', maxProducts);
            
            // Test selecting products for all 2 columns
            for (let i = 1; i <= 2; i++) {
                const selectElement = document.getElementById(`select${i}`);
                if (selectElement && selectElement.children.length > 1) {
                    selectElement.value = i;
                    updateProduct(i, i);
                    console.log(`Selected product ${i} for column ${i}`);
                }
            }
            
            // Wait a moment for all products to load
            setTimeout(() => {
                console.log('All products loaded, testing comparisons...');
                comparePrices();
                compareRatings();
                
                // Check if all elements exist
                for (let i = 1; i <= 2; i++) {
                    console.log(`Column ${i} elements:`, {
                        image: document.getElementById(`img${i}`)?.src,
                        price: document.getElementById(`price${i}`)?.textContent,
                        brand: document.getElementById(`brand${i}`)?.textContent,
                        rating: document.getElementById(`rating${i}`)?.textContent
                    });
                }
            }, 500);
        }
        
        // Make the test function globally available
        window.test2ProductComparison = test2ProductComparison;
        
        // Test function for price functionality
        function testPriceFunctionality() {
            console.log('=== Testing Price Functionality ===');
            
            // Test selecting products and checking price details
            for (let i = 1; i <= 2; i++) {
                const selectElement = document.getElementById(`select${i}`);
                if (selectElement && selectElement.children.length > 1) {
                    selectElement.value = i;
                    updateProduct(i, i);
                    console.log(`Selected product ${i} for column ${i}`);
                }
            }
            
            // Wait a moment for all products to load
            setTimeout(() => {
                console.log('All products loaded, testing price details...');
                
                // Check price details for each column
                for (let i = 1; i <= 2; i++) {
                    const priceBreakdown = document.getElementById(`priceBreakdown${i}`);
                    const currentPrice = document.querySelector(`#price${i} .current-price`);
                    const pricePerServing = document.getElementById(`pricePerServing${i}`);
                    
                    console.log(`Column ${i} price details:`, {
                        currentPrice: currentPrice?.textContent,
                        pricePerServing: pricePerServing?.textContent,
                        priceBreakdown: priceBreakdown?.innerHTML
                    });
                }
                
                // Test price comparison
                comparePrices();
                console.log('Price comparison completed');
            }, 500);
        }
        
        // Make the test function globally available
        window.testPriceFunctionality = testPriceFunctionality;
        
        // Test function for category-based price functionality
        function testCategoryPriceFunctionality() {
            console.log('=== Testing Category-Based Price Functionality ===');
            
            // Test with protein category products
            const proteinProducts = window.product ? window.product.filter(p => p.category === 'protein') : [];
            console.log('Protein products found:', proteinProducts.length);
            
            if (proteinProducts.length > 0) {
                // Select first 2 protein products
                proteinProducts.slice(0, 2).forEach((product, index) => {
                    const columnIndex = index + 1;
                    if (columnIndex <= 2) {
                        const selectElement = document.getElementById(`select${columnIndex}`);
                        if (selectElement) {
                            selectElement.value = product.id;
                            updateProduct(columnIndex, product.id);
                            console.log(`Selected product ${product.id}: ${product.title} - ${product.price}`);
                        }
                    }
                });
                
                // Wait a moment for all products to load
                setTimeout(() => {
                    console.log('All protein products loaded, testing price details...');
                    
                    // Check price details for each column
                    for (let i = 1; i <= 2; i++) {
                        const priceBreakdown = document.getElementById(`priceBreakdown${i}`);
                        const currentPrice = document.querySelector(`#price${i} .current-price`);
                        const pricePerServing = document.getElementById(`pricePerServing${i}`);
                        const category = document.getElementById(`category${i}`);
                        
                        console.log(`Column ${i} details:`, {
                            currentPrice: currentPrice?.textContent,
                            pricePerServing: pricePerServing?.textContent,
                            category: category?.textContent,
                            priceBreakdown: priceBreakdown?.innerHTML
                        });
                    }
                    
                    // Test price comparison
                    comparePrices();
                    console.log('Category-based price comparison completed');
                }, 500);
            } else {
                console.log('No protein products found for testing');
            }
        }
        
        // Make the test function globally available
        window.testCategoryPriceFunctionality = testCategoryPriceFunctionality;
        
        // Comprehensive test function for unified product data across all pages
        function testUnifiedProductData() {
            console.log('=== Testing Unified Product Data Across All Pages ===');
            
            // Test 1: Verify product data is loaded
            if (!window.product || !Array.isArray(window.product)) {
                console.error(' Product data not loaded properly');
                return;
            }
            console.log(` Product data loaded: ${window.product.length} products`);
            
            // Test 2: Verify all products have required fields
            const requiredFields = ['id', 'title', 'price', 'brand', 'category', 'rating', 'description'];
            const missingFields = [];
            
            window.product.forEach((product, index) => {
                requiredFields.forEach(field => {
                    if (!product.hasOwnProperty(field)) {
                        missingFields.push(`Product ${index + 1} (ID: ${product.id}) missing ${field}`);
                    }
                });
            });
            
            if (missingFields.length > 0) {
                console.error(' Missing required fields:', missingFields);
            } else {
                console.log(' All products have required fields');
            }
            
            // Test 3: Test category mapping
            if (window.categoryMap) {
                console.log(' Category mapping available');
                Object.keys(window.categoryMap).forEach(category => {
                    const productIds = window.categoryMap[category];
                    console.log(`  ${category}: ${productIds.length} products`);
                });
            } else {
                console.warn(' Category mapping not available');
            }
            
            // Test 4: Test utility functions
            if (window.productUtils) {
                console.log(' Product utilities available');
                
                // Test search functionality
                const searchResults = window.productUtils.searchProducts('protein');
                console.log(`  Search for 'protein': ${searchResults.length} results`);
                
                // Test category filtering
                const proteinProducts = window.productUtils.getProductsByCategory('protein');
                console.log(`  Protein category: ${proteinProducts.length} products`);
                
                // Test top rated products
                const topRated = window.productUtils.getTopRatedProducts(5);
                console.log(`  Top 5 rated products: ${topRated.map(p => p.title).join(', ')}`);
                
                // Test products on sale
                const onSale = window.productUtils.getProductsOnSale();
                console.log(`  Products on sale: ${onSale.length} products`);
            } else {
                console.warn(' Product utilities not available');
            }
            
            // Test 5: Test price consistency
            const priceIssues = [];
            window.product.forEach(product => {
                const price = parseFloat(product.price?.replace(/[^0-9,]/g, '').replace(',', ''));
                if (isNaN(price) || price <= 0) {
                    priceIssues.push(`Product ${product.id}: Invalid price - ${product.price}`);
                }
            });
            
            if (priceIssues.length > 0) {
                console.error(' Price issues found:', priceIssues);
            } else {
                console.log(' All products have valid prices');
            }
            
            // Test 6: Test rating consistency
            const ratingIssues = [];
            window.product.forEach(product => {
                const rating = parseFloat(product.rating);
                if (isNaN(rating) || rating < 0 || rating > 5) {
                    ratingIssues.push(`Product ${product.id}: Invalid rating - ${product.rating}`);
                }
            });
            
            if (ratingIssues.length > 0) {
                console.error(' Rating issues found:', ratingIssues);
            } else {
                console.log(' All products have valid ratings');
            }
            
            // Test 7: Test image consistency
            const imageIssues = [];
            window.product.forEach(product => {
                if (!product.image || product.image.trim() === '') {
                    imageIssues.push(`Product ${product.id}: Missing image`);
                }
            });
            
            if (imageIssues.length > 0) {
                console.error(' Image issues found:', imageIssues);
            } else {
                console.log(' All products have images');
            }
            
            // Test 8: Test comparison functionality
            console.log('Testing comparison functionality...');
            const testProducts = window.product.slice(0, 2);
            testProducts.forEach((product, index) => {
                const columnIndex = index + 1;
                updateProductData(columnIndex, product.id);
                console.log(`  Loaded product ${product.id} in column ${columnIndex}`);
            });
            
            // Test 9: Test localStorage integration
            const testCart = [
                { id: 1, quantity: 2 },
                { id: 3, quantity: 1 }
            ];
            localStorage.setItem('testCart', JSON.stringify(testCart));
            const retrievedCart = JSON.parse(localStorage.getItem('testCart') || '[]');
            console.log(` localStorage test: ${retrievedCart.length} items stored and retrieved`);
            
            // Test 10: Test cross-page data consistency
            console.log('Testing cross-page data consistency...');
            const sampleProduct = window.product[0];
            if (sampleProduct) {
                console.log(`  Sample product: ${sampleProduct.title} (${sampleProduct.price})`);
                console.log(`  Category: ${sampleProduct.category}, Rating: ${sampleProduct.rating}`);
                console.log(`  Brand: ${sampleProduct.brand}, Stock: ${sampleProduct.stock}`);
            }
            
            console.log('=== Unified Product Data Test Complete ===');
            console.log(' To test on other pages, run:');
            console.log('  - testUnifiedProductData() on any page');
            console.log('  - Check browser console for detailed results');
        }
        
        // Make the comprehensive test function globally available
        window.testUnifiedProductData = testUnifiedProductData;

        // Test function to debug comparison functionality
        function testComparisonFunctionality() {
            console.log('=== Testing Comparison Functionality ===');
            
            // Test 1: Check if product data is loaded
            console.log('1. Checking product data...');
            if (window.product && Array.isArray(window.product) && window.product.length > 0) {
                console.log(' Product data available:', window.product.length, 'products');
                console.log('Sample products:', window.product.slice(0, 3).map(p => ({ id: p.id, title: p.title, price: p.price })));
            } else {
                console.error(' Product data not available');
                return;
            }
            
            // Test 2: Check if search inputs are available
            console.log('2. Checking search inputs...');
            for (let i = 1; i <= 2; i++) {
                const searchInput = document.getElementById(`searchInput${i}`);
                if (searchInput) {
                    console.log(` Search input ${i} found`);
                } else {
                    console.error(` Search input ${i} not found`);
                }
            }
            
            // Test 3: Test product selection
            console.log('3. Testing product selection...');
            const testProductId = window.product[0].id;
            console.log(`Selecting product ID ${testProductId} (${window.product[0].title})`);
            
            // Select product in first column
            const searchInput1 = document.getElementById('searchInput1');
            if (searchInput1) {
                searchInput1.value = window.product[0].title;
                updateProduct(1, testProductId);
                
                // Check if data was populated
                setTimeout(() => {
                    console.log('4. Checking if data was populated...');
                    const image = document.getElementById('img1')?.src;
                    const title = document.getElementById('desc1')?.textContent;
                    const brand = document.getElementById('brand1')?.textContent;
                    const price = document.getElementById('price1')?.textContent;
                    
                    console.log('Image:', image);
                    console.log('Title:', title);
                    console.log('Brand:', brand);
                    console.log('Price:', price);
                    
                    if (image && image !== 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/1665px-No-Image-Placeholder.svg.png') {
                        console.log(' Product data populated successfully');
                    } else {
                        console.error(' Product data not populated');
                    }
                }, 500);
            }
        }
        
        // Make test function globally available
        window.testComparisonFunctionality = testComparisonFunctionality;

        // Quick test function for immediate debugging
        function quickTest() {
            console.log('=== Quick Test ===');
            console.log('Product data:', window.product ? `${window.product.length} products` : 'Not loaded');
            
            // Test search functionality
            const searchInput1 = document.getElementById('searchInput1');
            if (searchInput1) {
                searchInput1.value = 'protein';
                performSearch(1, 'protein');
                console.log('Search test completed');
            }
            
            // Test product selection
            if (window.product && window.product.length > 0) {
                updateProduct(1, window.product[0].id);
                console.log('Product selection test completed');
            }
            
            console.log('=== Quick Test Complete ===');
        }
        
        // Make quick test globally available
        window.quickTest = quickTest;

        // ===== SEARCH FUNCTIONALITY =====
        
        // Handle search input changes
        function handleSearchInput(columnIndex, value) {
            console.log(`Search input for column ${columnIndex}:`, value);
            
            if (!value || value.trim().length < 2) {
                hideSearchResults(columnIndex);
                return;
            }
            
            // Debounce search
            clearTimeout(window[`searchTimeout${columnIndex}`]);
            window[`searchTimeout${columnIndex}`] = setTimeout(() => {
                performSearch(columnIndex, value.trim());
            }, 300);
        }
        
        // Perform search for products
        function performSearch(columnIndex, query) {
            console.log(`Performing search for column ${columnIndex}:`, query);
            
            if (!window.product || !Array.isArray(window.product)) {
                console.error('Product data not available');
                return;
            }
            
            const results = window.product.filter(product => {
                const searchText = query.toLowerCase();
                return (
                    (product.title && product.title.toLowerCase().includes(searchText)) ||
                    (product.brand && product.brand.toLowerCase().includes(searchText)) ||
                    (product.description && product.description.toLowerCase().includes(searchText)) ||
                    (product.category && product.category.toLowerCase().includes(searchText))
                );
            }).slice(0, 8); // Limit to 8 results
            
            displaySearchResults(columnIndex, results, query);
        }
        
        // Display search results
        function displaySearchResults(columnIndex, results, query) {
            const resultsContainer = document.getElementById(`searchResultsList${columnIndex}`);
            if (!resultsContainer) return;
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search me-2"></i>
                        No products found for "${query}"
                    </div>
                `;
            } else {
                const resultsHTML = results.map(product => `
                    <div class="search-result-item" onclick="selectProductFromSearch(${columnIndex}, ${product.id})">
                        <img src="${product.image || 'src/placeholder.jpg'}" alt="${product.title}" class="search-result-image" onerror="this.src='src/placeholder.jpg'">
                        <div class="search-result-content">
                            <div class="search-result-title">${product.title}</div>
                            <div class="search-result-brand">${product.brand || 'Unknown Brand'}</div>
                            <div class="search-result-price">${product.price || 'N/A'}</div>
                            <div class="search-result-rating">
                                ${''.repeat(Math.floor(product.rating || 0))} ${product.rating || 0}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                resultsContainer.innerHTML = resultsHTML;
            }
            
            showSearchResults(columnIndex);
        }
        
        // Show search results container
        function showSearchResults(columnIndex) {
            const container = document.getElementById(`searchResults${columnIndex}`);
            if (container) {
                container.style.display = 'block';
            }
        }
        
        // Hide search results container
        function hideSearchResults(columnIndex) {
            const container = document.getElementById(`searchResults${columnIndex}`);
            if (container) {
                container.style.display = 'none';
            }
        }
        

        
        // Select product from search results
        function selectProductFromSearch(columnIndex, productId) {
            console.log(`Selecting product ${productId} for column ${columnIndex}`);
            
            // Update the search input with the selected product name
            const product = window.product.find(p => p.id === productId);
            if (product) {
                const input = document.getElementById(`searchInput${columnIndex}`);
                if (input) {
                    input.value = product.title;
                }
                
                // Hide search results
                hideSearchResults(columnIndex);
                
                // Update the product display
                updateProduct(columnIndex, productId);
                
                // Show success message
                showAlert(`Selected: ${product.title}`, 'success');
            }
        }
        
        // Handle keyboard navigation in search
        function handleSearchKeydown(columnIndex, event) {
            const resultsContainer = document.getElementById(`searchResultsList${columnIndex}`);
            if (!resultsContainer) return;
            
            const items = resultsContainer.querySelectorAll('.search-result-item');
            const currentIndex = Array.from(items).findIndex(item => item.classList.contains('selected'));
            
            switch (event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    if (currentIndex < items.length - 1) {
                        if (currentIndex >= 0) items[currentIndex].classList.remove('selected');
                        items[currentIndex + 1].classList.add('selected');
                    }
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    if (currentIndex > 0) {
                        items[currentIndex].classList.remove('selected');
                        items[currentIndex - 1].classList.add('selected');
                    }
                    break;
                case 'Enter':
                    event.preventDefault();
                    if (currentIndex >= 0) {
                        const productId = parseInt(items[currentIndex].getAttribute('onclick').match(/\d+/)[0]);
                        selectProductFromSearch(columnIndex, productId);
                    }
                    break;
                case 'Escape':
                    hideSearchResults(columnIndex);
                    break;
            }
        }
        
        // Handle clicks outside search results to hide them
        document.addEventListener('click', function(event) {
            for (let i = 1; i <= productCount; i++) {
                const searchContainer = document.getElementById(`searchResults${i}`);
                const searchInput = document.getElementById(`searchInput${i}`);
                
                if (searchContainer && searchInput) {
                    if (!searchContainer.contains(event.target) && !searchInput.contains(event.target)) {
                        hideSearchResults(i);
                    }
                }
            }
        });
        
        // Add buyNow function to handle redirection
        function buyNow(columnIndex) {
            // Add product to cart if not already, then redirect to cart page
            addToCart(columnIndex);
            setTimeout(() => {
                window.location.href = 'cart.html';
            }, 500);
        }
        
        // Cart and Wishlist Functions
        function addToCart(columnIndex) {
            const productId = getSelectedProductId(columnIndex);
            if (!productId) {
                showAlert('Please select a product first!', 'warning');
                return;
            }
            
            const product = window.product.find(p => p.id === productId);
            if (!product) {
                showAlert('Product not found!', 'error');
                return;
            }
            
            // Add to cart using cartManager if available
            if (window.cartManager) {
                try {
                    window.cartManager.addToCart(productId, 1);
                    showAlert(`${product.title} added to cart!`, 'success');
                    updateCartCount();
                } catch (error) {
                    showAlert('Error adding to cart: ' + error.message, 'error');
                }
            } else {
                // Fallback cart functionality
                let cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: productId,
                        title: product.title,
                        price: product.price,
                        brand: product.brand,
                        image: product.image,
                        quantity: 1
                    });
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                showAlert(`${product.title} added to cart!`, 'success');
                updateCartCount();
            }
        }
        
        function addToWishlist(columnIndex) {
            const productId = getSelectedProductId(columnIndex);
            if (!productId) {
                showAlert('Please select a product first!', 'warning');
                return;
            }
            
            const product = window.product.find(p => p.id === productId);
            if (!product) {
                showAlert('Product not found!', 'error');
                return;
            }
            
            let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const existingItem = wishlist.find(item => item.id === productId);
            
            if (existingItem) {
                showAlert(`${product.title} is already in your wishlist!`, 'info');
                return;
            }
            
            wishlist.push({
                id: productId,
                title: product.title,
                price: product.price,
                brand: product.brand,
                image: product.image,
                rating: product.rating,
                reviewCount: product.reviewCount
            });
            
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            showAlert(`${product.title} added to wishlist!`, 'success');
            updateWishlistCount();
        }
        
        // Get selected product ID for a column
        function getSelectedProductId(columnIndex) {
            const searchInput = document.getElementById(`searchInput${columnIndex}`);
            if (!searchInput || !searchInput.value.trim()) {
                return null;
            }
            
            // Find product by title
            const product = window.product.find(p => 
                p.title.toLowerCase() === searchInput.value.trim().toLowerCase()
            );
            
            return product ? product.id : null;
        }
        
        // Update cart count
        function updateCartCount() {
            let cartCount = 0;
            
            if (window.cartManager) {
                cartCount = window.cartManager.getCartCount();
            } else {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                cartCount = cart.reduce((total, item) => total + item.quantity, 0);
            }
            
            const cartBadge = document.querySelector('.cart-count');
            if (cartBadge) {
                cartBadge.textContent = cartCount;
                cartBadge.style.display = cartCount > 0 ? 'inline' : 'none';
            }
        }
        
        // Update wishlist count
        function updateWishlistCount() {
            const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const wishlistCount = wishlist.length;
            
            const wishlistBadge = document.querySelector('.wishlist-count');
            if (wishlistBadge) {
                wishlistBadge.textContent = wishlistCount;
                wishlistBadge.style.display = wishlistCount > 0 ? 'inline' : 'none';
            }
        }
        
        // Show alert function
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    </script>


<script src="data.js"></script>
<script src="main.js"></script>

</body>

</html>
